"use strict";(self.webpackChunkluna=self.webpackChunkluna||[]).push([[8],{54:(t,e,i)=>{var n=i(1),o=i(0),s=i(41);const r=1e4,a=1e5,l=1e6,c=1e-4,h=1.1920929e-7,d=new o.i,u=new o.i,y=new o.i,_=new o.i,p=new o.i;function g(t){return d.copy(t),d.w<0&&d.negate(),2*Math.atan2(d.z,d.w)}function m(t,e){e.set(0,0,Math.sin(.5*t),Math.cos(.5*t))}function f(t,e,i){y.copy(t),y.w<0&&y.negate(),m(e,_),function(t,e){u.copy(t),u.w<0&&u.negate(),m(g(u),e)}(y,p),p.invert(),i.mul2(_,p),i.mul(y)}let C=0,b=null,x=null,S=null;pc.waitForBox2D.then((t=>{b=t,x=new b.b2Vec2(0,0),S=new b.b2Vec2(0,0)}));class D extends n.k{constructor(t){super(),t=Object.assign({enabled:!0,simulated:!0,type:UnityEngine.RigidbodyType2D.Dynamic,collisionDetectionMode:UnityEngine.CollisionDetectionMode2D.Discrete,mass:1,constraints:0,useAutoMass:!1,gravityScale:1,angularDrag:.05,drag:0},t),this.id=C++,this._enabled=!!t.enabled,this._simulated=!!t.simulated,this._collisionDetectionMode=t.collisionDetectionMode,this._constraints=t.constraints||0,this._freezeRotation=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezeRotation),this._freezeX=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionX),this._freezeY=!!(this._constraints&UnityEngine.RigidbodyConstraints2D.FreezePositionY),this._mass=t.mass,this._material=t.material||null,this._useFullKinematicContacts=!1;const e=new b.b2BodyDef;e.awake=this._enabled,e.type=t.type===UnityEngine.RigidbodyType2D.Dynamic?b.b2_dynamicBody:t.type===UnityEngine.RigidbodyType2D.Kinematic?b.b2_kinematicBody:b.b2_staticBody,e.bullet=this._collisionDetectionMode===UnityEngine.CollisionDetectionMode2D.Continuous,e.gravityScale=Number.isFinite(t.gravityScale)?t.gravityScale:1,e.angularDamping=t.angularDrag>=0?t.angularDrag:.05,e.linearDamping=t.drag>0?t.drag:0,e.fixedRotation=this._freezeRotation,e.fixedPositionX=this._freezeX,e.fixedPositionY=this._freezeY,e.enabled=this._simulated,e.autoMass=t.useAutoMass,this._body=this.world.CreateBody(e),b.destroy(e),this._body.SetComponentId(this.id),this.resetMassData(),this._worldTransformVersion=-1,this._cullingLayer=-1,this._lastSyncEntityPosition=new o.l(-1/0,-1/0,-1/0),this._lastSyncEntityRotation=new o.i(-1/0,-1/0,-1/0,-1/0),this._lastSyncEntityScale=new o.l(-1/0,-1/0,-1/0),this["__UnityEngine.Rigidbody2D"]=null,pc.markPhysics2dModuleAsUsed(),TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"Rigidbody2DComponent")}get adapter(){return n.a.getApplication().systems.physics2D.adapter}get world(){return this.adapter._world}get body(){return this._body}get destroyed(){return this._destroyed}onEnable(){return!!super.onEnable()&&(this._simulated&&this.adapter.enableRigidbody(this),!0)}onDisable(){return!!super.onDisable()&&(this._simulated&&this.adapter.disableRigidbody(this),this.resetVelocity(),this.resetAngularVelocity(),!0)}onDestroy(){return!!super.onDestroy()&&(this._destroyed=!0,this.onDisable(),this.world.DestroyBody(this._body),!0)}syncLayers(){const t=this.entity;t.cullingLayer!==this._cullingLayer&&(this._cullingLayer=t.cullingLayer,this.body.SetUnityLayers(1<<t.cullingLayer),this.wakeUp())}addForce(t){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),this._body.ApplyForceToCenter(x,!0))}addImpulse(t){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),this._body.ApplyLinearImpulseToCenter(x,!0))}addForceAtPosition(t,e){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),S.Set(e.x,e.y),this._body.ApplyForce(x,S,!0))}addImpulseAtPosition(t,e){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),S.Set(e.x,e.y),this._body.ApplyLinearImpulse(x,S,!0))}addRelativeForce(t){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),this._body.ApplyForceToCenter(this.body.GetWorldVector(x),!0))}addRelativeImpulse(t){this.body.GetType()===b.b2_dynamicBody&&(x.Set(t.x,t.y),this._body.ApplyLinearImpulseToCenter(this.body.GetWorldVector(x),!0))}addTorque(t){this.body.GetType()===b.b2_dynamicBody&&this._body.ApplyTorque(t,!0)}addTorqueImpulse(t){this.body.GetType()===b.b2_dynamicBody&&this._body.ApplyAngularImpulse(t,!0)}getVelocity(){if(this.body.GetType()===b.b2_staticBody)return o.k.ZERO;const t=this._body.GetLinearVelocity();return new o.k(t.x,t.y)}setVelocity(t){this.body.GetType()!==b.b2_staticBody&&(x.Set(t.x,t.y),this._body.SetLinearVelocity(x))}resetVelocity(){x.Set(0,0),this._body.SetLinearVelocity(x)}getAngularVelocity(){return this.body.GetType()===b.b2_staticBody?0:this._body.GetAngularVelocity()*o.j}setAngularVelocity(t){this.body.GetType()!==b.b2_staticBody&&this._body.SetAngularVelocity(t*o.e)}resetAngularVelocity(){this._body.SetAngularVelocity(0)}getMass(){return this._mass}setMass(t){this.body.GetAutoMass()||this._mass===t||(this._mass=(0,o.n)(t,c,l),this.resetMassData())}getUseAutoMass(){return this.body.GetAutoMass()}setUseAutoMass(t){this.body.GetAutoMass()!==t&&(this.body.SetAutoMass(t),this.resetMassData())}resetMassData(){this._mass=this.body.ResetMassData(this._mass)}getInertia(){return this.body.GetType()===b.b2_staticBody?0:this.body.IsUsingExplicitInertia()?this.body.GetExplicitInertia():this.body.GetInertia()}setInertia(t){t=(0,o.n)(t,c,l),this.body.SetExplicitInertia(t),this.body.SetUsingExplicitInertia(!0),this.resetMassData()}getDrag(){return this.body.GetLinearDamping()}setDrag(t){this.body.SetLinearDamping((0,o.n)(t,0,l))}getAngularDrag(){return this.body.GetAngularDamping()}setAngularDrag(t){this.body.SetAngularDamping((0,o.n)(t,0,l))}getPosition(){this.adapter.autoSyncTransforms();const t=this.body.GetPosition();return new o.k(t.x,t.y)}setPosition(t){S.Set(t.x,t.y),this._body.SetTransform(S,this.body.GetAngle()),this.wakeUp(),this.body.ClearMovePosition()}getRotation(){return this.adapter.autoSyncTransforms(),this.body.GetAngle()*o.j}setRotation(t){this.body.SetTransform(this.body.GetPosition(),t*o.e),this.wakeUp(),this.body.ClearMoveRotation()}setRotationFromQuaternion(t){const e=g(t);this.setRotation(e)}getGravityScale(){return this._body.GetGravityScale()}setGravityScale(t){this._body.SetGravityScale(t)}getCollisionDetectionMode(){return this._collisionDetectionMode}setCollisionDetectionMode(t){this._collisionDetectionMode!==t&&(this._collisionDetectionMode=t,this._body.SetBullet(t===UnityEngine.CollisionDetectionMode2D.Continuous))}getSimulated(){return this._simulated}setSimulated(t){t!==this._simulated&&(this._simulated=t,this._enabled&&(t?this.adapter.enableRigidbody(this):this.adapter.disableRigidbody(this)))}getBodyType(){switch(this._body.GetType()){case b.b2_dynamicBody:return UnityEngine.RigidbodyType2D.Dynamic;case b.b2_kinematicBody:return UnityEngine.RigidbodyType2D.Kinematic;case b.b2_staticBody:return UnityEngine.RigidbodyType2D.Static;default:return NaN}}setBodyType(t){if(this.getBodyType()!==t){switch(t){case UnityEngine.RigidbodyType2D.Dynamic:this.body.SetType(b.b2_dynamicBody),this.resetMassData();break;case UnityEngine.RigidbodyType2D.Kinematic:this.body.SetType(b.b2_kinematicBody);break;case UnityEngine.RigidbodyType2D.Static:{this.body.SetType(b.b2_staticBody);const t=new b.b2Vec2(0,0);this.body.SetLinearVelocity(t),b.destroy(t),this.body.SetAngularVelocity(0);break}}this.body.ClearMovePosition(),this.body.ClearMoveRotation(),this.recalculateContacts()}}recalculateContacts(){for(let t=this.body.GetFixtureList();b.getPointer(t)!==b.getPointer(b.NULL);t=t.GetNext()){const e=this.adapter.getColliderComponentForCollider(t);e.recalculateContacts(),this.body.GetType()===b.b2_staticBody&&e.wakeAllBodyContacts()}this.wakeUp()}recreateJoints(){let t=this.body.GetJointList();for(;b.getPointer(t)!==b.getPointer(b.NULL);){const e=t.next;this.adapter.getJointComponentForJoint(t.joint).recreateJoint(),t=e}}getIsKinematic(){return this._body.GetType()===b.b2_kinematicBody}setIsKinematic(t){this.setBodyType(t?UnityEngine.RigidbodyType2D.Kinematic:UnityEngine.RigidbodyType2D.Dynamic)}getUseFullKinematicContacts(){return this._useFullKinematicContacts}setUseFullKinematicContacts(t){if(this._useFullKinematicContacts!==t){this._useFullKinematicContacts=t;for(let t=this.body.GetFixtureList();b.getPointer(t)!==b.getPointer(b.NULL);t=t.GetNext()){this.adapter.getColliderComponentForCollider(t).rebuildFixtures()}this.recalculateContacts()}}getFreezeRotation(){return this._freezeRotation}setFreezeRotation(t){t!==this._freezeRotation&&(this._freezeRotation=!!t,this._body.SetFixedRotation(this._freezeRotation),this._freezeRotation?this._constraints|=UnityEngine.RigidbodyConstraints2D.FreezeRotation:this._constraints&=~UnityEngine.RigidbodyConstraints2D.FreezeRotation)}getConstraints(){return this._constraints}setConstraints(t){t!==this._constraints&&(this._constraints=t,this._freezeRotation!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezeRotation)&&this._body.SetFixedRotation(this._freezeRotation=!this._freezeRotation),this._freezeX!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionX)&&this._body.SetFixedPositionX(this._freezeX=!this._freezeX),this._freezeY!==!!(t&UnityEngine.RigidbodyConstraints2D.FreezePositionY)&&this._body.SetFixedPositionY(this._freezeY=!this._freezeY))}getCenterOfMass(){if(this.body.GetType()===b.b2_staticBody)return o.k.ZERO;const t=this.body.GetLocalCenter();return new o.k(t.x,t.y)}setCenterOfMass(t){this.body.SetUsingExplicitCenterOfMass(!0);const e=new b.b2Vec2(t.x,t.y);this.body.SetExplicitCenterOfMass(e),b.destroy(e),this.resetMassData()}moveRotation(t){this.body.GetType()===b.b2_staticBody?this.setRotation(t):this.body.SetMoveRotation(t*o.e)}moveRotationFromQuaternion(t){const e=g(t);this.moveRotation(e)}movePosition(t){if(this.body.GetType()===b.b2_staticBody)this.setPosition(t);else{const e=new b.b2Vec2(t.x,t.y);this.body.SetMovePosition(e),b.destroy(e)}}wakeUp(){this._body.SetAwake(!0)}getSharedMaterial(){return this._material}setSharedMaterial(t){if(this._material!==t){this._material=t,t=t||this.system.app.systems.collider2D.defaultMaterial;for(let t=this.body.GetFixtureList();b.getPointer(t)!==b.getPointer(b.NULL);t=t.GetNext()){const e=this.adapter.getColliderComponentForCollider(t),i=e.getEffectiveMaterial();t.SetFriction(i.friction),t.SetRestitution(i.bounciness),e.recalculateContacts()}}}getAttachedColliderCount(){let t=this.body.GetFixtureList(),e=0;for(;b.getPointer(t)!==b.getPointer(b.NULL);)e++,t=t.GetNext();return e}getAttachedColliders(t){let e=this.body.GetFixtureList(),i=0;for(;i<t.length&&b.getPointer(e)!==b.getPointer(b.NULL);){const n=this.adapter.getColliderComponentForCollider(e);n?(t[i]=n.code,i++,e=e.GetNext()):e=e.GetNext()}return i}}class w extends n.k{constructor(t){super(),t?(this._enabled=!!t.enabled,this._useColliderMask=!!t.useColliderMask,this.colliderMask=t.colliderMask):(this._enabled=!0,this._useColliderMask=!1,this.colliderMask=0),this._adapter=n.a.getApplication().systems.physics2D.adapter,pc.markPhysics2dModuleAsUsed()}get useColliderMask(){return this._useColliderMask}set useColliderMask(t){this._useColliderMask=t}_initializeCode(){this._code&&(this["__UnityEngine.Effector2D"]=this._code,this._code.handle=this)}onEnable(){return!!super.onEnable()&&(this._adapter.enableEffector(this),!0)}ignoreContacts(){return!1}onBeforeCollision2D(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),n=this._adapter.getColliderComponentForCollider(e).body.GetLinearVelocity(),o=this._adapter.getColliderComponentForCollider(i).body.GetLinearVelocity();n.y+o.y>0&&t.SetEnabled(!1)}onDisable(){return!!super.onDisable()&&(this._adapter.disableEffector(this),!0)}onDestroy(){return!!super.onDestroy()&&(this.onDisable(),!0)}}w.checkForEffectorColliderMaskUsage=function(t,e){return t.getIsUsedByEffector()&&null!==t.getEffector()&&t.getEffector().useColliderMask||e.getIsUsedByEffector()&&null!==e.getEffector()&&e.getEffector().useColliderMask},w.checkEffectorColliderMask=function(t,e){return!(!t.enabled||!e.enabled)&&(w.processCheckEffectorColliderMask(t,e)&&w.processCheckEffectorColliderMask(e,t))},w.processCheckEffectorColliderMask=function(t,e){if(!t.getIsUsedByEffector())return!0;const i=t.getEffector();return null!==i&&(!i.useColliderMask||!i.ignoreContacts()&&0!=(i.colliderMask&e.entity.layerMask))};const A=new o.h,M=new o.l,T=new o.h,B=new o.i,F=new o.h,E=new o.l;let R=null;pc.waitForBox2D.then((t=>{R=t}));class k extends s.a{constructor(t){super(t),k.instance=this,this._effectors2d=new Map}setup(){var t;this._world=this.options.world,this._newContacts={},this._contacts={},this._oldContacts={},this._contactCount={},this._disabledContacts=new Set,this.velocityIterations=0,this.positionIterations=0,this._groundBody=null,this.collisionMatrix=new Uint32Array(32),this._bodyMap={},this._colliderMap={},this._jointMap={},this._world.SetContactFilter((t=this,Object.assign(new R.JSContactFilter,{ShouldCollide(e,i){const n=R.wrapPointer(e,R.b2Fixture),o=R.wrapPointer(i,R.b2Fixture),s=t.getColliderComponentForCollider(n),r=t.getColliderComponentForCollider(o),a=s._bodyComponent,l=r._bodyComponent,c=a.body,h=l.body,d=s.entity,u=r.entity;return!(!a._enabled||!l.enabled)&&!!(c.GetType()===R.b2_dynamicBody||h.GetType()===R.b2_dynamicBody||a&&c.GetType()===R.b2_kinematicBody&&a.getUseFullKinematicContacts()||l&&h.GetType()===R.b2_kinematicBody&&l.getUseFullKinematicContacts()||n.IsSensor()||o.IsSensor())&&!t._disabledContacts.has(t._getCollidersUid(s,r))&&(w.checkForEffectorColliderMaskUsage(s,r)?w.checkEffectorColliderMask(s,r):!(t.collisionMatrix[d.cullingLayer]&1<<u.cullingLayer))}}))),this._world.SetContactListener((t=>Object.assign(new R.JSContactListener,{BeginContact(e){const i=R.wrapPointer(e,R.b2Contact),n=t._getContactUid(i);t._contacts[n]||t._newContacts[n]?t._contactCount[n]++:(t._contactCount[n]=0,t._newContacts[n]=i),delete t._oldContacts[n]},EndContact(e){const i=R.wrapPointer(e,R.b2Contact),n=t._getContactUid(i),o=t._contacts[n];o&&--t._contactCount[n]<=0&&(t._oldContacts[n]=o,t._contactCount[n]=0)},PreSolve(e){const i=R.wrapPointer(e,R.b2Contact),n=t.getColliderComponentForCollider(i.GetFixtureA()),o=t.getColliderComponentForCollider(i.GetFixtureB());if(n._usedByEffector){const e=t._effectors2d.get(n._entity._guid);e&&e.onBeforeCollision2D(i)}else if(o._usedByEffector){const e=t._effectors2d.get(o._entity._guid);e&&e.onBeforeCollision2D(i)}},PostSolve(){}}))(this))}get groundBody(){return this._groundBody||(this._groundBody=new D({enabled:!0,simulated:!0,type:UnityEngine.RigidbodyType2D.Static}),this._groundBody._entity=n.a.getApplication().root),this._groundBody}addRigidbody(t){t.SetEnabled(!0),this.preSimulationSynchronization(this.getBodyComponentForBody(t),s.a.PreSyncStages.TransformToPhysics)}removeRigidbody(t){t.SetEnabled(!1)}fetchBody(t){let e=t;for(;e;){if(e._enabledInHierarchy){const t=this.getAttachedRigidbodyComponent(e);if(t)return t}e=e._parent}return this.groundBody}enableCollider(t){const e=this.fetchBody(t.entity);t._bodyComponent=e,this.getRelativeTransformAndScale(e,t,A,M),t.updateRelativeTransformAndScale(A,M),t.syncLayers(),t.enable(),this._colliders.push(t),t._worldTransformVersion=t._entity.aabbVersion}disableCollider(t){const e=this._colliders,i=e.indexOf(t);if(!(i<0)){e[i]=e[e.length-1],e.length-=1;for(let e=0;e<t._fixtures.length;e++)this.unlinkColliderAndColliderComponent(t._fixtures[e],t);t.disable()}}enableConstraint(t){t.enable(),this._constraints.push(t)}disableConstraint(t){delete this._jointMap[t.id];const e=this._constraints,i=e.indexOf(t);i<0||(t.disable(),e[i]=e[e.length-1],e.length-=1)}onSimulationStep(t){this._world.Step(t,this.velocityIterations,this.positionIterations,0,-1)}getAttachedColliders(t){return t._unityComponents.collider2D}getAttachedRigidbodyComponent(t){const e=t._unityComponents.rigidbody2D[0];return e&&e.enabled&&e.getSimulated()&&!e.destroyed?e:null}getRelativeTransformAndScale(t,e,i,n){const s=t.entity,r=e.entity;if(s===r){T.copy(s.getWorldTransform()),T.setTranslation(o.l.ZERO);const t=g(s.getRotation());B.set(0,0,Math.sin(t/2),Math.cos(t/2)),B.invert(),F.setTRS(o.l.ZERO,B,o.l.ONE),i.mul2(F,T)}else{T.copy(r.getWorldTransform());const t=g(s.getRotation());B.set(0,0,Math.sin(t/2),Math.cos(t/2)),B.invert(),E.copy(s.getPosition()),E.scale(-1),B.transformVector(E,E),F.setTRS(E,B,o.l.ONE),i.mul2(F,T)}n.copy(s.getLocalScale())}preSimulationSynchronization(t,e){if(e!==s.a.PreSyncStages.TransformToPhysics)return;t.syncLayers();const i=t.entity,n=t.body;if(t._worldTransformVersion===i.aabbVersion)return;t._worldTransformVersion=i.aabbVersion;const o=i.getPosition(),r=i.getRotation(),a=i.getLossyScale(),l=!t._lastSyncEntityPosition.equals(o),c=!t._lastSyncEntityRotation.equals(r),h=!t._lastSyncEntityScale.equals(a);if(t._lastSyncEntityPosition.copy(o),t._lastSyncEntityRotation.copy(r),t._lastSyncEntityScale.copy(a),l||c){const e=n.GetPosition();let i=n.GetAngle();l&&e.Set(o.x,o.y),c&&(B.copy(r),B.w<0&&B.negate(),i=2*Math.atan2(B.z,B.w)),n.SetTransform(e,i),t.recalculateContacts(),l&&n.ClearMovePosition(),c&&n.ClearMoveRotation()}(l||c||h)&&t.recreateJoints()}preSimulationSynchronizationForCollider(t){t.syncLayers();const e=t._entity.aabbVersion;t._worldTransformVersion!==e&&(t._worldTransformVersion=e,this.getRelativeTransformAndScale(t._bodyComponent,t,A,M),t.updateRelativeTransformAndScale(A,M))}autoSyncTransforms(){n.i.instance.physics2DSettings.autoSyncTransforms&&this.syncTransforms(n.a.getApplication().root)}postSimulationSynchronization(t){const e=t.body,i=t.entity;let n=null,o=i.getParent();for(;o&&!n;)n=o._unityComponents.rigidbody2D[0],o=o.getParent();if(!e.IsAwake()&&e.GetType()!==R.b2_staticBody&&!n)return e.ClearMovePosition(),void e.ClearMoveRotation();const s=i.getPosition(),r=i.getRotation(),a=e.GetPosition();let l=e.GetAngle();if(e.GetType()===R.b2_kinematicBody&&n&&n.body.IsAwake()){const t=e.IsMovingPosition(),n=e.IsMovingRotation();E.copy(s),B.copy(r),t&&(E.x=a.x,E.y=a.y),n?f(B,l,B):l=g(B),(t||n)&&(i.setPosition(E),i.setRotation(B));const o=new R.b2Vec2(E.x,E.y);e.SetTransform(o,l),R.destroy(o),e.SetAwake(!0)}else E.copy(s),E.x=a.x,E.y=a.y,f(r,l,B),i.setPosition(E),i.setRotation(B);t._lastSyncEntityPosition.copy(i.getPosition()),t._lastSyncEntityRotation.copy(i.getRotation()),e.ClearMovePosition(),e.ClearMoveRotation()}_getContactUid(t){return this._getUid(t.GetFixtureA().GetComponentId(),t.GetFixtureB().GetComponentId())}_getCollidersUid(t,e){const i=t.id,n=e.id;return this._getUid(i,n)}_getUid(t,e){return t>e?t+1e7*e:e+1e7*t}handleContacts(){this._triggerNewContacts(),this._triggerPersistentContacts(),this._removeNewContacts(),this._triggerOldContacts()}_triggerNewContacts(){for(const t in this._newContacts)this._contacts[t]||this._triggerContactCallback("Enter",this._newContacts[t],Number(t),!0)}_triggerPersistentContacts(){for(const t in this._contacts)this._triggerContactCallback("Stay",this._contacts[t],Number(t))}_removeNewContacts(){for(const t in this._newContacts)this._contacts[t]=this._newContacts[t],delete this._newContacts[t]}_triggerOldContacts(){for(const t in this._oldContacts){const e=this._oldContacts[t],i=this.getColliderComponentForCollider(e.GetFixtureA()),n=this.getColliderComponentForCollider(e.GetFixtureB());i&&i.removeContact(Number(t)),n&&n.removeContact(Number(t)),this._triggerContactCallback("Exit",e,Number(t)),delete e["__UnityEngine.Collision2D"],delete this._oldContacts[t],delete this._contacts[t]}}_triggerContactCallback(t,e,i,o=!1){if(this._disabledContacts.has(i))return;const s=e.GetFixtureA(),r=e.GetFixtureB(),a=this.getColliderComponentForCollider(s),l=this.getColliderComponentForCollider(r);if(!a||!l)return;const c=n.d.instance;if(a._isTrigger||l._isTrigger){const e="OnTrigger"+t+"2D";c.startSubSection([n.d.PHYSICS2D,e]),this.dispatchContact(a._entity,e,l.code);let i=a._bodyComponent;i&&a._entity!==i._entity&&this.dispatchContact(i._entity,e,l.code),this.dispatchContact(l._entity,e,a.code),i=l._bodyComponent,i&&l._entity!==i._entity&&this.dispatchContact(i._entity,e,a.code),c.endSubSection([n.d.PHYSICS2D,e])}else{o&&(a.addContact(e,i),l.addContact(e,i));const s="OnCollision"+t+"2D";c.startSubSection([n.d.PHYSICS2D,s]),this.dispatchContact(a._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0));let r=a._bodyComponent;r&&a._entity!==r._entity&&this.dispatchContact(r._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(0)),this.dispatchContact(l._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1)),r=l._bodyComponent,r&&l._entity!==r._entity&&this.dispatchContact(r._entity,s,UnityEngine.Object.FromHandle(UnityEngine.Collision2D,e).ConfigureFor(1)),c.endSubSection([n.d.PHYSICS2D,s])}}ignoreCollision(t,e,i){if(!t.entity._enabledInHierarchy||!e.entity._enabledInHierarchy)return;const n=this._getCollidersUid(t,e);i?this._disabledContacts.add(n):this._disabledContacts.delete(n),t.recalculateContacts(),e.recalculateContacts()}getIgnoreCollision(t,e){const i=this._getCollidersUid(t,e);return this._disabledContacts.has(i)}getLayerCollisionMask(t){return this.collisionMatrix[t]}setLayerCollisionMask(t,e){const i=this.collisionMatrix[t];if(i===e)return;this.collisionMatrix[t]=e;const n=1<<t;for(let t=0;t<32;t++)0!=(e&1<<t)?this.collisionMatrix[t]|=n:this.collisionMatrix[t]&=~n;const o=i^e;for(let t=this._world.GetBodyList();R.getPointer(t)!==R.getPointer(R.NULL);t=t.GetNext()){const e=this.getBodyComponentForBody(t);if(!e)continue;if(0!=(e.entity.layerMask&o))for(let e=t.GetFixtureList();R.getPointer(e)!==R.getPointer(R.NULL);e=e.GetNext())e.Refilter()}}getIgnoreLayerCollision(t,e){return 0!=(this.collisionMatrix[t]&1<<e)}setIgnoreLayerCollision(t,e,i){i?(this.collisionMatrix[t]|=1<<e,this.collisionMatrix[e]|=1<<t):(this.collisionMatrix[t]&=~(1<<e),this.collisionMatrix[e]&=~(1<<t));const n=1<<t|1<<e;for(let t=this._world.GetBodyList();R.getPointer(t)!==R.getPointer(R.NULL);t=t.GetNext()){const e=this.getBodyComponentForBody(t);if(!e)continue;if(0!=(e.entity.layerMask&n))for(let e=t.GetFixtureList();R.getPointer(e)!==R.getPointer(R.NULL);e=e.GetNext())e.Refilter()}}enableEffector(t){this._effectors2d.set(t._entity._guid,t)}disableEffector(t){this._effectors2d.delete(t._entity._guid)}get world(){return this._world}getCollisionMatrix(){return this.collisionMatrix}getBodyComponentForBody(t){return this._bodyMap[t.GetComponentId()]}linkBodyAndBodyComponent(t,e){this._bodyMap[t.GetComponentId()]=e}unlinkBodyAndBodyComponent(t,e){delete this._bodyMap[t.GetComponentId()]}getColliderComponentForCollider(t){return this._colliderMap[t.GetComponentId()]}linkColliderAndColliderComponent(t,e){this._colliderMap[t.GetComponentId()]=e}unlinkColliderAndColliderComponent(t,e){delete this._colliderMap[t.GetComponentId()]}getJointComponentForJoint(t){return this._jointMap[t.GetComponentId()]}linkJointAndJointComponent(t,e){this._jointMap[t.GetComponentId()]=e}unlinkJointAndJointComponent(t,e){delete this._jointMap[t.GetComponentId()]}}k.instance=null;let G=null;pc.waitForBox2D.then((t=>{G=t}));class P extends n.j{constructor(t){super(t),this.id="physics2D",this.performanceSamplerSection=n.d.PHYSICS2D,this._defaultMaterial=new UnityEngine.PhysicsMaterial2D,this._defaultMaterial.friction=.4,this._defaultMaterial.bounciness=0,this._autoSyncTransforms=!1,this._gravity=new o.k(0,-9.81);const e=new G.b2Vec2(this._gravity.x,this._gravity.y);this._world=new G.b2World(e),G.destroy(e),this._adapter=new k({world:this._world});const i=n.i.instance.physics2DSettings;this._applyProjectSettings(i)}onFixedUpdate(t){this._adapter.onFixedUpdate(t)}setIgnoreCollisionBetweenLayers(t,e,i){this._adapter.setIgnoreCollisionBetweenLayers(t,e,i)}syncHierarchy(t){this._adapter.syncHierarchy(t)}syncTransforms(t){this._autoSyncTransforms&&this._adapter.syncTransforms(t)}get adapter(){return this._adapter}get gravity(){return this._gravity}set gravity(t){this._gravity=t;const e=this._world.GetGravity();e.x=t.x,e.y=t.y,this._world.SetGravity(e)}get defaultMaterial(){return this._defaultMaterial}set defaultMaterial(t){t&&(this._defaultMaterial=t)}get autoSyncTransforms(){return this._autoSyncTransforms}set autoSyncTransforms(t){this._autoSyncTransforms=t}get velocityIterations(){return k.instance.velocityIterations}set velocityIterations(t){k.instance.velocityIterations=t>0?t:1}get positionIterations(){return k.instance.positionIterations}set positionIterations(t){k.instance.positionIterations=t>0?t:1}_applyProjectSettings(t){this.gravity=t.gravity.clone(),this.autoSyncTransforms=t.autoSyncTransforms,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.defaultMaterial=t.material,this.adapter.world.SetAngularSleepTolerance(t.angularSleepTolerance),this.adapter.world.SetLinearSleepTolerance(t.linearSleepTolerance),this.adapter.world.SetBaumgarteScale(t.baumgarteScale),this.adapter.world.SetBaumgarteTOIScale(t.baumgarteTOIScale),this.adapter.world.SetTimeToSleep(t.timeToSleep),this.adapter.world.SetMaxRotationSpeed(t.maxRotationSpeed),this.adapter.world.SetMaxTranslationSpeed(t.maxTranslationSpeed),this.adapter.world.SetMaxLinearCorrection(t.maxLinearCorrection),this.adapter.world.SetMaxAngularCorrection(t.maxAngularCorrection),this.adapter.world.SetVelocityThreshold(t.velocityThreshold),this.adapter.world.SetDefaultContactOffset(t.defaultContactOffset);for(let e=0;e<t.collisionMatrix.length;e++){const i=t.collisionMatrix[e];this.setIgnoreCollisionBetweenLayers(i.layerId,i.otherLayerId,i.enabled)}}}let j=null;pc.waitForBox2D.then((()=>{j=Object.assign(new G.JSRayCastCallback,{ReportFixture:(t,e,i,s)=>{const r=G.wrapPointer(t,G.b2Fixture),a=G.wrapPointer(e,G.b2Vec2),l=G.wrapPointer(i,G.b2Vec2),c=k.instance.getColliderComponentForCollider(r);if(r.IsSensor()&&!n.i.instance.physics2DSettings.queriesHitTriggers)return-1;if(0==(1<<c._cullingLayer&j.layerMask))return 1;const h=c.entity.getPosition().z;if(h<j.minDepth||h>j.maxDepth)return 1;const d=new UnityEngine.RaycastHit2D;if(d.normal=new o.k(l.x,l.y),d.point=new o.k(a.x,a.y),d.centroid=d.point.clone(),d.fraction=s,d.distance=0,d.fraction>0){const t=d.point.x-j.pointA.x,e=d.point.y-j.pointA.y;d.distance=Math.sqrt(t*t+e*e)}d.collider=c.code;for(let t=0;t<j.allResults.length;t++){const e=j.allResults[t];if(d.collider===e.collider)return s<e.fraction&&(j.allResults[t]=d),1}return j.allResults.push(d),1},run(){j.allResults.length=0;const t=j.pointA.x-j.pointB.x,e=j.pointA.y-j.pointB.y,i=t*t+e*e>14210854822304103e-30;if(n.i.instance.physics2DSettings.queriesStartInColliders){const t=new o.k,e=new o.k(j.pointA.x,j.pointA.y);i&&(t.copy(e),t.x-=j.pointB.x,t.y-=j.pointB.y,t.normalize());const n=P.overlapPointAll(e,j.layerMask,j.minDepth,j.maxDepth);for(let i=0;i<n.length;i++){const o=n[i],s=new UnityEngine.RaycastHit2D;s.collider=o,s.point=e,s.centroid=s.point.clone(),s.normal=t,s.distance=0,s.fraction=0,j.allResults.push(s)}}return i?(k.instance.world.RayCast(j,j.pointA,j.pointB),j.allResults.sort(((t,e)=>t.fraction-e.fraction)),j.allResults.length):j.allResults.length},pointA:new G.b2Vec2(0,0),pointB:new G.b2Vec2(0,0),layerMask:0,minDepth:1/0,maxDepth:-1/0,allResults:[]})})),P.raycast=(t,e,i,n,o,s)=>{k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(t.x,t.y),e.normalize();const r=i>Number.MAX_SAFE_INTEGER;j.pointB.x+=e.x*(r?a:i),j.pointB.y+=e.y*(r?a:i),j.layerMask=n,j.minDepth=o,j.maxDepth=s,j.run();for(let t=0;t<j.allResults.length;t++)r&&(j.allResults[t].fraction*=a);return j.allResults[0]||new UnityEngine.RaycastHit2D},P.raycastAll=(t,e,i,n,o,s)=>{k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(t.x,t.y),e.normalize();const r=i>Number.MAX_SAFE_INTEGER;j.pointB.x+=e.x*(r?a:i),j.pointB.y+=e.y*(r?a:i),j.layerMask=n,j.minDepth=o,j.maxDepth=s,j.run();for(let t=0;t<j.allResults.length;t++)r&&(j.allResults[t].fraction*=a);return[...j.allResults]},P.raycastNonAlloc=(t,e,i,n,o,s,r)=>{if(!i||0===i.length)return 0;k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(t.x,t.y),e.normalize();const l=n>Number.MAX_SAFE_INTEGER;j.pointB.x+=e.x*(l?a:n),j.pointB.y+=e.y*(l?a:n),j.layerMask=o,j.minDepth=s,j.maxDepth=r,j.run();const c=Math.min(j.allResults.length,i.length);for(let t=0;t<c;t++)l&&(j.allResults[t].fraction*=a),i[t]=j.allResults[t];return c},P.linecast=(t,e,i,n,o)=>(k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(e.x,e.y),j.layerMask=i,j.minDepth=n,j.maxDepth=o,j.run(),j.allResults[0]||new UnityEngine.RaycastHit2D),P.linecastAll=(t,e,i,n,o)=>(k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(e.x,e.y),j.layerMask=i,j.minDepth=n,j.maxDepth=o,j.run(),[...j.allResults]),P.linecastNonAlloc=(t,e,i,n,o,s)=>{if(!i||0===i.length)return 0;k.instance.autoSyncTransforms(),j.pointA.Set(t.x,t.y),j.pointB.Set(e.x,e.y),j.layerMask=n,j.minDepth=o,j.maxDepth=s,j.run();const r=Math.min(j.allResults.length,i.length);for(let t=0;t<r;t++)i[t]=j.allResults[t];return r};const z={ReportFixture(t){const e=G.wrapPointer(t,G.b2Fixture),i=n.a.getApplication().systems.physics2D.adapter.getColliderComponentForCollider(e);if(e.IsSensor()&&!n.i.instance.physics2DSettings.queriesHitTriggers)return 1;if(0==(1<<i._cullingLayer&this.layerMask))return 1;const o=i.entity.getPosition().z;return o<this.minDepth||o>this.maxDepth?1:this.checkFixture(e,i)?(this.allResults.push(i),this.allResults.sort(((t,e)=>t.entity.getPosition().z-e.entity.getPosition().z)),1):1},run(){this.allResults.length=0,this.aabb=this.aabb||new G.b2AABB,this.initializeAABB(),k.instance.world.QueryAABB(this,this.aabb)},checkFixture:(t,e)=>!0,initializeAABB(){throw new Error("Not implemented")},layerMask:0,minDepth:1/0,maxDepth:-1/0,aabb:null,allResults:[]};let U=null;const L=()=>Object.assign(new G.JSQueryCallback,z,{checkFixture(t,e){return t.TestPoint(this.point)},initializeAABB(){U.aabb.lowerBound=U.point,U.aabb.upperBound=U.point},point:new G.b2Vec2(0,0)});pc.waitForBox2D.then((()=>{U=L()})),P.overlapPoint=(t,e,i,n)=>(k.instance.autoSyncTransforms(),U.layerMask=e,U.minDepth=i,U.maxDepth=n,U.point.Set(t.x,t.y),U.run(),U.allResults.length?U.allResults[0].code:null),P.overlapPointAll=(t,e,i,n)=>(k.instance.autoSyncTransforms(),U.layerMask=e,U.minDepth=i,U.maxDepth=n,U.point.Set(t.x,t.y),U.run(),U.allResults.map((t=>t.code))),P.overlapPointNonAlloc=(t,e,i,n,o)=>{if(!e||0===e.length)return 0;k.instance.autoSyncTransforms(),U.layerMask=i,U.minDepth=n,U.maxDepth=o,U.point.Set(t.x,t.y),U.run();const s=Math.min(e.length,U.allResults.length);for(let t=0;t<s;t++)e[t]=U.allResults[t].code;return s};const J=(t,e,i,n)=>{const o=t.GetChildCount(),s=e.GetChildCount();for(let r=0;r<o;r++)for(let o=0;o<s;o++)if(G.b2TestOverlap(t,r,e,o,i,n))return!0;return!1};let I=null;const q=()=>Object.assign(new G.JSQueryCallback,z,{checkFixture:(t,e)=>I.isPointQuery?t.TestPoint(I.point):J(I.circleShape,t.GetShape(),I.queryTransform,t.GetBody().GetTransform()),initializeAABB(){if(I.radius<1e-5)return I.aabb.lowerBound=I.aabb.upperBound=this.point,void(I.isPointQuery=!0);I.circleShape.m_p.Set(I.point.x,I.point.y),I.circleShape.m_radius=I.radius,I.queryTransform.SetIdentity(),I.circleShape.ComputeAABB(I.aabb,I.queryTransform,0,!1),I.isPointQuery=!1},point:new G.b2Vec2(0,0),radius:0,circleShape:new G.b2CircleShape,queryTransform:new G.b2Transform(new G.b2Vec2(0,0),new G.b2Rot(0)),isPointQuery:!1});pc.waitForBox2D.then((()=>{I=q()})),P.overlapCircle=(t,e,i,n,o)=>(k.instance.autoSyncTransforms(),I.layerMask=i,I.minDepth=n,I.maxDepth=o,I.point.Set(t.x,t.y),I.radius=e,I.run(),I.allResults.length?I.allResults[0].code:null),P.overlapCircleAll=(t,e,i,n,o)=>(k.instance.autoSyncTransforms(),I.layerMask=i,I.minDepth=n,I.maxDepth=o,I.point.Set(t.x,t.y),I.radius=e,I.run(),I.allResults.map((t=>t.code))),P.overlapCircleNonAlloc=(t,e,i,n,o,s)=>{if(!i||0===i.length)return 0;k.instance.autoSyncTransforms(),I.layerMask=n,I.minDepth=o,I.maxDepth=s,I.point.Set(t.x,t.y),I.radius=e,I.run();const r=Math.min(i.length,I.allResults.length);for(let t=0;t<r;t++)i[t]=I.allResults[t].code;return r};let O=null;pc.waitForBox2D.then((()=>{O=Object.assign(new G.JSQueryCallback,z,{checkFixture:(t,e)=>J(O.polygonShape,t.GetShape(),O.queryTransform,t.GetBody().GetTransform()),initializeAABB(){O.polygonShape.SetAsBox(Math.max(c,.5*O.size.x),Math.max(c,.5*O.size.y),O.point,O.angle),O.queryTransform.SetIdentity(),O.polygonShape.ComputeAABB(O.aabb,O.queryTransform,0,!1)},point:new G.b2Vec2(0,0),size:new G.b2Vec2(0,0),angle:0,polygonShape:new G.b2PolygonShape,queryTransform:new G.b2Transform(new G.b2Vec2(0,0),new G.b2Rot(0))})})),P.overlapBox=(t,e,i,n,s,r)=>(k.instance.autoSyncTransforms(),O.layerMask=n,O.minDepth=s,O.maxDepth=r,O.point.Set(t.x,t.y),O.size.Set(e.x,e.y),O.angle=i*o.e,O.run(),O.allResults.length?O.allResults[0].code:null),P.overlapBoxAll=(t,e,i,n,s,r)=>(k.instance.autoSyncTransforms(),O.layerMask=n,O.minDepth=s,O.maxDepth=r,O.point.Set(t.x,t.y),O.size.Set(e.x,e.y),O.angle=i*o.e,O.run(),O.allResults.map((t=>t.code))),P.overlapBoxNonAlloc=(t,e,i,n,s,r,a)=>{k.instance.autoSyncTransforms(),O.layerMask=s,O.minDepth=r,O.maxDepth=a,O.point.Set(t.x,t.y),O.size.Set(e.x,e.y),O.angle=i*o.e,O.run();const l=Math.min(n.length,O.allResults.length);for(let t=0;t<l;t++)n[t]=O.allResults[t].code;return l};let v=null;pc.waitForBox2D.then((()=>{v=Object.assign(new G.JSQueryCallback,z,{checkFixture:(t,e)=>J(v.queryCollider._fixtures[0].GetShape(),t.GetShape(),v.queryCollider._fixtures[0].GetBody().GetTransform(),t.GetBody().GetTransform()),initializeAABB(){const t=v.queryCollider.getBounds();v.aabb.lowerBound.Set(t.min.x,t.min.y),v.aabb.upperBound.Set(t.max.x,t.max.y)},queryCollider:null})})),P.overlapCollider=(t,e,i,n,o)=>{if(!e||0===e.length)return 0;k.instance.autoSyncTransforms(),v.queryCollider=t,O.layerMask=i,O.minDepth=n,O.maxDepth=o,v.run();const s=Math.min(e.length,v.allResults.length);for(let t=0;t<s;t++)e[t]=v.allResults[t].code;return s};let V=null;const N=()=>Object.assign(new G.JSQueryCallback,z,{checkFixture(t,e){return J(this.capsuleShape,t.GetShape(),this.queryTransform,t.GetBody().GetTransform())},initializeAABB(){const t=Math.max(c,this.size.x),e=Math.max(c,this.size.y);if(this.direction===UnityEngine.CapsuleDirection2D.Vertical){const i=Math.max(c,e-t);this.capsuleShape.SetByExtentsY(.5*t,i,this.point,this.angle)}else{const i=Math.max(c,t-e);this.capsuleShape.SetByExtentsX(.5*e,i,this.point,this.angle)}this.queryTransform.SetIdentity(),this.capsuleShape.ComputeAABB(V.aabb,this.queryTransform,0,!1)},point:new G.b2Vec2(0,0),size:new G.b2Vec2(0,0),direction:0,angle:0,capsuleShape:new G.b2CapsuleShape,queryTransform:new G.b2Transform(new G.b2Vec2(0,0),new G.b2Rot(0))});pc.waitForBox2D.then((()=>{V=N()})),P.overlapCapsule=(t,e,i,n,s,r,a)=>(k.instance.autoSyncTransforms(),V.point.Set(t.x,t.y),V.size.Set(e.x,e.y),V.direction=i,V.angle=n*o.e,V.layerMask=s,V.minDepth=r,V.maxDepth=a,V.run(),V.allResults.length>0?V.allResults[0].code:null),P.overlapCapsuleAll=(t,e,i,n,s,r,a)=>(k.instance.autoSyncTransforms(),V.point.Set(t.x,t.y),V.size.Set(e.x,e.y),V.direction=i,V.angle=n*o.e,V.layerMask=s,V.minDepth=r,V.maxDepth=a,V.run(),V.allResults.map((t=>t.code))),P.overlapCapsuleNonAlloc=(t,e,i,n,s,r,a,l)=>{if(!s||0===s.length)return 0;k.instance.autoSyncTransforms(),V.point.Set(t.x,t.y),V.size.Set(e.x,e.y),V.direction=i,V.angle=n*o.e,V.layerMask=r,V.minDepth=a,V.maxDepth=l,V.run();const c=Math.min(V.allResults.length,s.length);for(let t=0;t<c;t++)s[t]=V.allResults[t].code;return c},P.ignoreCollision=(t,e,i)=>{k.instance.ignoreCollision(t,e,i)},P.getIgnoreCollision=(t,e)=>k.instance.getIgnoreCollision(t,e);const H={run(){this.foundFixtureProxies.length=0,this.results.length=0,this.initialize(),k.instance.world.QueryProxyAABB(this,this.sweepAABB);for(let t=0;t<this.foundFixtureProxies.length;t++){const e=this.foundFixtureProxies[t],i=e.fixture,o=i.GetBody(),s=new G.b2Transform(new G.b2Vec2(0,0),new G.b2Rot(0)),r=o.GetTransform(),a=new G.b2MassData;o.GetMassData(a);const l=a.center,c=this.sweepInput.sweepB;c.localCenter=l,c.c0.x=c.c.x=r.q.c*l.x-r.q.s*l.y+r.p.x,c.c0.y=c.c.y=r.q.s*l.x+r.q.c*l.y+r.p.y,c.a0=c.a=o.GetAngle(),c.alpha0=0,this.sweepInput.tMax=1;const d=n.i.instance.physics2DSettings.queriesStartInColliders,u=i.GetShape(),y=e.childIndex;this.sweepInput.proxyB.Set(u,y);const _=new G.b2TOIOutput;if(G.b2TimeOfImpact(_,this.sweepInput),_.state===G.e_touching||_.state===G.e_overlapped&&d){const t=_.t;if(!d&&_.state===G.e_touching&&t<=10*h&&G.b2TestOverlap(this.shape,0,u,y,this.castTransform,r))continue;this.sweepInput.sweepA.GetTransform(s,t);const i=s.p.x-this.sweepInput.sweepA.c0.x,n=s.p.y-this.sweepInput.sweepA.c0.y,o=Math.sqrt(i*i+n*n);this.sweepInput.tMax=t,this.addRaycastHit(this.buildRaycastHit(e,s,r,t,o))}G.destroy(a),G.destroy(s)}this.results.sort(((t,e)=>t.distance-e.distance))},addRaycastHit(t){if(t){for(let e=0;e<this.results.length;e++)if(this.results[e].collider===t.collider)return void(this.results[e].fraction>t.fraction&&(this.results[e]=t));this.results.push(t)}},buildRaycastHit(t,e,i,n,s){const r=new G.b2Fixture;r.m_shape=this.shape;const a=G.b2Contact.prototype.Create(r,0,t.fixture,t.childIndex,k.instance.world.GetBlockAllocator()),l=a.GetFixtureB()===r;let c=e,h=i,d=this.shape.m_radius,u=t.fixture.GetShape().m_radius;l&&(c=i,h=e,d=t.fixture.GetShape().m_radius,u=this.shape.m_radius);const y=a.GetManifold();if(a.Evaluate(y,c,h),0===y.pointCount){const t=.0025;l?y.radiusB+=t:y.radiusA+=t,this.shape.m_radius+=t,a.Evaluate(y,c,h),this.shape.m_radius-=t}const _=y.pointCount,p=new UnityEngine.RaycastHit2D;if(_>0){const i=new G.b2WorldManifold;i.Initialize(y,c,d,h,u),p.normal=new o.k(i.normal.x,i.normal.y),l||(p.normal=new o.k(-i.normal.x,-i.normal.y)),p.collider=k.instance.getColliderComponentForCollider(t.fixture).code,p.fraction=n,p.distance=s;const r=e.p;if(p.centroid=new o.k(r.x,r.y),1===_)p.point=new o.k(i.points.x,i.points.y);else{const t=i.GetPointAt(0),e=i.GetPointAt(1),n=i.GetSeparationAt(0),s=i.GetSeparationAt(1),r=Math.abs(n-s)<25e-6?new G.b2Vec2(.5*(t.x+e.x),.5*(t.y+e.y)):n<s?t:e;p.point=new o.k(r.x,r.y)}}return y.pointCount=0,G.b2Contact.prototype.Destroy(a,k.instance.world.GetBlockAllocator()),G.destroy(r),_>0?p:null},ReportFixtureProxy(t){const e=G.wrapPointer(t,G.b2FixtureProxy),i=e.fixture,o=k.instance.getColliderComponentForCollider(i);if(i.IsSensor()&&!n.i.instance.physics2DSettings.queriesHitTriggers)return!0;if(0==(1<<o._cullingLayer&this.layerMask))return!0;const s=o.entity.getPosition().z;return s<this.minDepth||s>this.maxDepth||this.foundFixtureProxies.push(e),!0},initialize(){this.sweepInput=this.sweepInput||new G.b2TOIInput,this.sweepAABB=this.sweepAABB||new G.b2AABB,this.castTransform=this.castTransform||new G.b2Transform(new G.b2Vec2(0,0),new G.b2Rot(0)),this.shape=this.initializeShape();const t=new G.b2Rot(this.angle);this.castTransform.p.Set(this.pointA.x,this.pointA.y),this.castTransform.q=t;const e=new G.b2Transform(this.pointB,t),i=new G.b2AABB,n=new G.b2AABB;this.shape.ComputeAABB(i,this.castTransform,0,!1),this.shape.ComputeAABB(n,e,0,!1),this.sweepAABB.Combine(i,n),this.sweepInput.proxyA.Set(this.shape,0);const o=this.sweepInput.sweepA;o.localCenter.SetZero(),o.c0=this.castTransform.p,o.c=e.p,o.a0=o.a=this.angle,o.alpha0=0,G.destroy(t),G.destroy(e),G.destroy(i),G.destroy(n)},initializeShape(){throw new Error("Not implemented")},pointA:null,pointB:null,angle:0,layerMask:-1,minDepth:-1/0,maxDepth:1/0,results:[],foundFixtureProxies:[],shape:null,sweepInput:null,sweepAABB:null,castTransform:null};pc.waitForBox2D.then((t=>{H.pointA=new t.b2Vec2(0,0),H.pointB=new t.b2Vec2(0,0)}));let X=null;const W=()=>Object.assign(new G.JSQueryProxyCallback,H,{initializeShape(){return this.circleShape.m_radius=this.radius,this.circleShape},circleShape:new G.b2CircleShape,radius:0});pc.waitForBox2D.then((()=>{X=W()})),P.circleCast=(t,e,i,n,o,s,r)=>{if(e<=c)return new UnityEngine.RaycastHit2D;X.pointA.Set(t.x,t.y),X.pointB.Set(t.x,t.y),i.normalize();const l=n>Number.MAX_SAFE_INTEGER;X.pointB.x+=i.x*(l?a:n),X.pointB.y+=i.y*(l?a:n),X.radius=e,X.layerMask=o,X.minDepth=s,X.maxDepth=r,k.instance.autoSyncTransforms(),X.run();for(let t=0;t<X.results.length;t++)l&&(X.results[t].fraction*=a);return X.results.length?X.results[0]:new UnityEngine.RaycastHit2D},P.circleCastAll=(t,e,i,n,o,s,r)=>{if(e<=c)return[];X.pointA.Set(t.x,t.y),X.pointB.Set(t.x,t.y),i.normalize();const l=n>Number.MAX_SAFE_INTEGER;X.pointB.x+=i.x*(l?a:n),X.pointB.y+=i.y*(l?a:n),X.radius=e,X.layerMask=o,X.minDepth=s,X.maxDepth=r,k.instance.autoSyncTransforms(),X.run();for(let t=0;t<X.results.length;t++)l&&(X.results[t].fraction*=a);return[...X.results]},P.circleCastNonAlloc=(t,e,i,n,o,s,r,l)=>{if(e<=c)return 0;if(0===n.length)return 0;X.pointA.Set(t.x,t.y),X.pointB.Set(t.x,t.y),i.normalize();const h=o>Number.MAX_SAFE_INTEGER;X.pointB.x+=i.x*(h?a:o),X.pointB.y+=i.y*(h?a:o),X.radius=e,X.layerMask=s,X.minDepth=r,X.maxDepth=l,k.instance.autoSyncTransforms(),X.run();const d=Math.min(X.results.length,n.length);for(let t=0;t<d;t++)h&&(X.results[t].fraction*=a),n[t]=X.results[t];return d};let Y=null;const Q=()=>Object.assign(new G.JSQueryProxyCallback,H,{initializeShape(){return this.boxShape.SetAsBox(this.boxHalfSize.x,this.boxHalfSize.y),this.boxShape},boxShape:new G.b2PolygonShape,boxHalfSize:new G.b2Vec2(0,0)});pc.waitForBox2D.then((()=>{Y=Q()})),P.boxCast=(t,e,i,n,s,r,l,h)=>{if(e.x<=c||e.y<=c)return new UnityEngine.RaycastHit2D;Y.pointA.Set(t.x,t.y),Y.pointB.Set(t.x,t.y),n.normalize();const d=s>Number.MAX_SAFE_INTEGER;Y.pointB.x+=n.x*(d?a:s),Y.pointB.y+=n.y*(d?a:s),Y.boxHalfSize.Set(.5*e.x,.5*e.y),Y.angle=i*o.e,Y.layerMask=r,Y.minDepth=l,Y.maxDepth=h,k.instance.autoSyncTransforms(),Y.run();for(let t=0;t<Y.results.length;t++)d&&(Y.results[t].fraction*=a);return Y.results.length?Y.results[0]:new UnityEngine.RaycastHit2D},P.boxCastAll=(t,e,i,n,s,r,l,h)=>{if(e.x<=c||e.y<=c)return[];Y.pointA.Set(t.x,t.y),Y.pointB.Set(t.x,t.y),n.normalize();const d=s>Number.MAX_SAFE_INTEGER;Y.pointB.x+=n.x*(d?a:s),Y.pointB.y+=n.y*(d?a:s),Y.boxHalfSize.Set(.5*e.x,.5*e.y),Y.angle=i*o.e,Y.layerMask=r,Y.minDepth=l,Y.maxDepth=h,k.instance.autoSyncTransforms(),Y.run();for(let t=0;t<Y.results.length;t++)d&&(Y.results[t].fraction*=a);return[...Y.results]},P.boxCastNonAlloc=(t,e,i,n,s,r,l,h,d)=>{if(e.x<=c||e.y<=c)return 0;if(0===s.length)return 0;Y.pointA.Set(t.x,t.y),Y.pointB.Set(t.x,t.y),n.normalize();const u=r>Number.MAX_SAFE_INTEGER;Y.pointB.x+=n.x*(u?a:r),Y.pointB.y+=n.y*(u?a:r),Y.boxHalfSize.Set(.5*e.x,.5*e.y),Y.angle=i*o.e,Y.layerMask=l,Y.minDepth=h,Y.maxDepth=d,k.instance.autoSyncTransforms(),Y.run();const y=Math.min(Y.results.length,s.length);for(let t=0;t<y;t++)u&&(Y.results[t].fraction*=a),s[t]=Y.results[t];return y};let K=null;const Z=()=>Object.assign(new G.JSQueryProxyCallback,H,{initializeShape(){const t=Math.max(c,this.size.x),e=Math.max(c,this.size.y);if(this.direction===UnityEngine.CapsuleDirection2D.Vertical){const i=Math.max(c,e-t);this.capsuleShape.SetByExtentsY(.5*t,i)}else{const i=Math.max(c,t-e);this.capsuleShape.SetByExtentsX(.5*e,i)}return this.capsuleShape},capsuleShape:new G.b2CapsuleShape,size:new G.b2Vec2(0,0),direction:0});pc.waitForBox2D.then((()=>{K=Z()})),P.capsuleCast=(t,e,i,n,s,r,l,h,d)=>{if(e.x<=c||e.y<=c)return new UnityEngine.RaycastHit2D;K.pointA.Set(t.x,t.y),K.pointB.Set(t.x,t.y),s.normalize();const u=r>Number.MAX_SAFE_INTEGER;K.pointB.x+=s.x*(u?a:r),K.pointB.y+=s.y*(u?a:r),K.size.Set(e.x,e.y),K.direction=i,K.angle=n*o.e,K.layerMask=l,K.minDepth=h,K.maxDepth=d,k.instance.autoSyncTransforms(),K.run();for(let t=0;t<K.results.length;t++)u&&(K.results[t].fraction*=a);return K.results.length?K.results[0]:new UnityEngine.RaycastHit2D},P.capsuleCastAll=(t,e,i,n,s,r,l,h,d)=>{if(e.x<=c||e.y<=c)return[];K.pointA.Set(t.x,t.y),K.pointB.Set(t.x,t.y),s.normalize();const u=r>Number.MAX_SAFE_INTEGER;K.pointB.x+=s.x*(u?a:r),K.pointB.y+=s.y*(u?a:r),K.size.Set(e.x,e.y),K.direction=i,K.angle=n*o.e,K.layerMask=l,K.minDepth=h,K.maxDepth=d,k.instance.autoSyncTransforms(),K.run();for(let t=0;t<K.results.length;t++)u&&(K.results[t].fraction*=a);return[...K.results]},P.capsuleCastNonAlloc=(t,e,i,n,s,r,l,h,d,u)=>{if(e.x<=c||e.y<=c)return 0;if(0===r.length)return 0;K.pointA.Set(t.x,t.y),K.pointB.Set(t.x,t.y),s.normalize();const y=l>Number.MAX_SAFE_INTEGER;K.pointB.x+=s.x*(y?a:l),K.pointB.y+=s.y*(y?a:l),K.size.Set(e.x,e.y),K.direction=i,K.angle=n*o.e,K.layerMask=h,K.minDepth=d,K.maxDepth=u,k.instance.autoSyncTransforms(),K.run();const _=Math.min(K.results.length,r.length);for(let t=0;t<_;t++)y&&(K.results[t].fraction*=a),r[t]=K.results[t];return _},P.getRayIntersectionAll=(t,e,i,n)=>{const s=i>Number.MAX_SAFE_INTEGER,r=s?1:1/i,l=t.clone();if(e.normalize(),l.x+=e.x*(s?a:i),l.y+=e.y*(s?a:i),l.z+=e.z*(s?a:i),Math.abs(t.z-l.z)<h)return[];const c=new o.k(t.x,t.y),d=new o.k(l.x,l.y),u=P.linecastAll(c,d,n,Math.min(t.z,l.z),Math.max(t.z,l.z));if(0===u.length)return[];const y=t.z<l.z;y?u.sort(((t,e)=>t.collider.handle.entity.position.z-e.collider.handle.entity.position.z)):u.sort(((t,e)=>e.collider.handle.entity.position.z-t.collider.handle.entity.position.z));const _=new o.l(0,0,y?1:-1),p=[];for(let i=0;i<u.length;i++){const n=u[i],s=n.collider.handle.entity.position.z,a=new o.l(0,0,s),l=-_.dot(a),c=e.dot(_),d=-t.dot(_)-l;if(Math.abs(c)<h)continue;const y=d/c;if(y<=0)continue;const g=e.clone().scale(y).add(t),m=new o.k(g.x,g.y);n.collider.handle.overlapPoint(m)&&(n.point=m,n.fraction=y*r,n.distance=y,p.push(n))}return p},P.getRayIntersectionNonAlloc=(t,e,i,n,o)=>{if(!i||0===i.length)return 0;const s=P.getRayIntersectionAll(t,e,n,o),r=Math.min(i.length,s.length);for(let t=0;t<r;t++)i[t]=s[t];return r},P.isTouching=(t,e)=>{const i=t.handle,n=e.handle;if(!i._contacts||i===n)return!1;for(const t in i._contacts){if(!i._contacts.hasOwnProperty(t))continue;const e=i._contacts[t],o=e.GetFixtureA(),s=e.GetFixtureB(),r=k.instance.getColliderComponentForCollider(o),a=k.instance.getColliderComponentForCollider(s);if(r===n||a===n)return!0}return!1},P.getLayerCollisionMask=t=>k.instance.getLayerCollisionMask(t),P.setLayerCollisionMask=(t,e)=>k.instance.setLayerCollisionMask(t,e),P.getIgnoreLayerCollision=(t,e)=>k.instance.getIgnoreLayerCollision(t,e),P.setIgnoreLayerCollision=(t,e,i)=>k.instance.setIgnoreLayerCollision(t,e,i);let $=null;pc.waitForBox2D.then((t=>{$=t}));let tt=0;class et extends n.k{constructor(t){t=t||{},super(),this.id=tt++,this._enabled=void 0===t.enabled||t.enabled,this._active=this._enabled,this._shape=t.shape||null,this._isTrigger=!!t.isTrigger,this._usedByEffector=!!t.usedByEffector,this._density=t.density>=0?t.density:1,this._offset=this._offset||t.offset||new o.k,this._type=t.type||"collider2D",this._relativeTransform=new o.h,this._accumulatedScale=new o.l(1,1,1),this._material=t.material||null,this._contacts={},this._bodyComponent=null,this._fixtures=[],this._worldTransformVersion=-1,this._cullingLayer=-1,this._errorFlag=!1,this["__UnityEngine.Collider2D"]=null,pc.markPhysics2dModuleAsUsed()}get code(){return this._code||this._initializeCode(),this._code}get shape(){return this._shape}get body(){return this._bodyComponent?this._bodyComponent.body:null}get type(){return this._type}_initializeCode(){this._code&&(this["__UnityEngine.Collider2D"]=this._code,this._code.handle=this)}onEnable(){return!!super.onEnable()&&(k.instance.enableCollider(this),!0)}onDisable(){return!!super.onDisable()&&(k.instance.disableCollider(this),!0)}enable(){this._active=!0,0===this._fixtures.length&&this.rebuildFixtures()}disable(){this._active=!1,this.cleanup()}cleanup(t=!1){if(0!==this._fixtures.length){for(let t=0;t<this._fixtures.length;t++)k.instance.unlinkColliderAndColliderComponent(this._fixtures[t],this),this._bodyComponent.body.DestroyFixture(this._fixtures[t],!1);this._bodyComponent.resetMassData(),this._fixtures=[],t||(this._contacts={})}}onDestroy(){return!!super.onDestroy()&&(this.onDisable(),!0)}updateRelativeTransformAndScale(t,e){const i=this._relativeTransform.equalsWithEpsilon(t)&&this._accumulatedScale.equalsWithEpsilon(e);this._relativeTransform.copy(t),this._accumulatedScale.copy(e),i||0===this._fixtures.length&&!this._errorFlag||this.rebuildFixtures()}rebuildFixtures(){this._errorFlag=!1,this.wakeAllBodyContacts(),this.cleanup(!0);const t=this.getFixtureDefs(),e=this._bodyComponent.body;for(let i=0;i<t.length;i++){const n=t[i],o=e.CreateFixture(n,!1);this._fixtures.push(o),o.SetComponentId(this.id),k.instance.linkColliderAndColliderComponent(o,this),o.SetUnityFilterData(1<<this._cullingLayer,-1,-1,-1),this._bodyComponent.resetMassData(),$.destroy(n.shape),$.destroy(n)}this.wakeAllBodyContacts(),this._bodyComponent.wakeUp()}rebuildFixturesIfNecessary(){(0!==this._fixtures.length||this._errorFlag)&&this.rebuildFixtures()}recalculateContacts(){for(let t=this._bodyComponent.body.GetFixtureList();$.getPointer(t)!==$.getPointer($.NULL);t=t.GetNext())t.Refilter();const t=this._bodyComponent.body;if(t){t.SetAwake(!0);let e=t.GetContactList();for(;$.getPointer(e)!==$.getPointer($.NULL);){const t=e.contact;t.ResetFriction(),t.ResetRestitution(),e=e.next}t.GetWorld().FlagNewContacts()}}wakeAllBodyContacts(){for(let t=this._bodyComponent.body.GetContactList();$.getPointer(t)!==$.getPointer($.NULL);t=t.next){const e=t.contact;e.IsIgnored()||(e.GetFixtureA().GetBody().SetAwake(!0),e.GetFixtureB().GetBody().SetAwake(!0))}}getFixtureDefs(){const t=this.getEffectiveMaterial(),e=this.generateShapes(),i=[];for(let n=0;n<e.length;n++){const o=new $.b2FixtureDef;o.shape=e[n],o.friction=t?t.friction:.4,o.restitution=t?t.bounciness:0,o.density=this.getDensity(),o.isSensor=this._isTrigger,i.push(o)}return i}generateShapes(){throw new Error("Not implemented")}syncLayers(){if(this.entity.cullingLayer!==this._cullingLayer&&(this._cullingLayer=this.entity.cullingLayer,0!==this._fixtures.length)){for(let t=0;t<this._fixtures.length;t++)this._fixtures[t].SetUnityFilterData(1<<this._cullingLayer,-1,-1,-1),this._fixtures[t].Refilter();this.recalculateContacts()}}addContact(t,e){this._contacts[e]=t}removeContact(t){this._contacts&&delete this._contacts[t]}overlapPoint(t){k.instance.autoSyncTransforms();const e=new $.b2Vec2(t.x,t.y);for(let t=0;t<this._fixtures.length;t++)if(this._fixtures[t].TestPoint(e))return $.destroy(e),!0;return $.destroy(e),!1}getContactedCollidersInternal(t,e){if(!t||e<=0)return 0;let i=0;for(const n in this._contacts){if(i>=e)break;if(!this._contacts.hasOwnProperty(n))continue;const o=this._contacts[n],s=o.GetFixtureA(),r=o.GetFixtureB();if(!s.GetBody()||!r.GetBody())continue;const a=k.instance.getColliderComponentForCollider(s),l=k.instance.getColliderComponentForCollider(r);this._fixtures.includes(s)?t[i++]=l.code:this._fixtures.includes(r)&&(t[i++]=a.code)}return i}getContactedColliders(t){return this.getContactedCollidersInternal(t,t.length)}getContactedCollidersAll(){const t=[];return this.getContactedCollidersInternal(t,1/0),t}getContactedContactsInternal(t,e){if(!t||e<=0)return 0;let i=0;for(const n in this._contacts){const o=this._contacts[n],s=o.GetFixtureA().GetComponentId()===this.id?k.instance.getColliderComponentForCollider(o.GetFixtureB()):k.instance.getColliderComponentForCollider(o.GetFixtureA());if(t[i]=UnityEngine.ContactPoint2D.ConfigureFor(o,this.code,s.code,0),i++,i>=e)break}return i}getContactedContacts(t){return this.getContactedContactsInternal(t,t.length)}getContactedContactsAll(){const t=[];return this.getContactedContactsInternal(t,1/0),t}getIsTrigger(){return this._isTrigger}setIsTrigger(t){t=!!t,this._isTrigger!==t&&(this._isTrigger=t,this.rebuildFixturesIfNecessary())}getIsUsedByEffector(){return this._usedByEffector}setIsUsedByEffector(t){this._usedByEffector=!!t}getEffector(){return k.instance._effectors2d.get(this.entity._guid)||null}getOffset(){return this._offset.clone()}setOffset(t=o.k.ZERO){this._offset.equals(t)||(this._offset.copy(t),this.rebuildFixturesIfNecessary())}getShapeCount(){return this._fixtures.length}overlapCollider(t,e){let i=t.minDepth,n=t.maxDepth;t.useDepth||(i=-1/0,n=1/0);let o=t.layerMask;return t.useLayerMask||(o=-1),P.overlapCollider(this,e,i,n,o)}getBounds(){if(!this._fixtures.length||!this._active)return new o.b;const t=new $.b2AABB,e=new $.b2AABB,i=this._bodyComponent.body.GetTransform();for(let n=0;n<this._fixtures.length;n++){const o=this._fixtures[n].GetShape();for(let s=0;s<o.GetChildCount();s++)0===n?o.ComputeAABB(t,i,s,!1):(o.ComputeAABB(e,i,s,!1),t.Combine(e))}const n=t.GetCenter(),s=t.GetExtents();return $.destroy(t),$.destroy(e),new o.b(new o.l(n.x,n.y,this.entity.getPosition().z),new o.l(s.x,s.y,0))}getDensity(){return this._density}setDensity(t){if(this._density===t)return;const e=this._bodyComponent;e&&e.getUseAutoMass()&&e.body.GetType()===$.b2_dynamicBody&&(this._density=(0,o.n)(t,0,l),this.updateFixtureDensity(),e.resetMassData(),e.wakeUp())}getEffectiveMaterial(){return this._material||this._bodyComponent.getSharedMaterial()||this._system.defaultMaterial}getSharedMaterial(){return this._material}setSharedMaterial(t){if(this._material===t)return;this._material=t;const e=this.getEffectiveMaterial();for(let t=0;t<this._fixtures.length;t++)this._fixtures[t].SetFriction(e.friction),this._fixtures[t].SetRestitution(e.bounciness);this.recalculateContacts()}updateFixtureDensity(){const t=this._bodyComponent,e=t&&t.getUseAutoMass()&&t.body.GetType()===$.b2_dynamicBody?this._density:1;for(let t=0;t<this._fixtures.length;t++)this._fixtures[t].SetDensity(e)}}let it=null;pc.waitForBox2D.then((t=>{it=t}));let nt=null;pc.waitForBox2D.then((t=>{nt=t}));let ot=null;pc.waitForBox2D.then((t=>{ot=t}));let st=null;pc.waitForBox2D.then((t=>{st=t}));const rt=new o.l;let at=null;pc.waitForBox2D.then((t=>{at=t}));const lt=new o.l;class ct extends et{constructor(t){(t=t||{}).type="boxCollider2D",super(t),this._offset=(new o.k).copy(t.center||o.k.ZERO),this._size=(new o.k).copy(t.size||o.k.ONE),this._size.x=Math.max(c,this._size.x),this._size.y=Math.max(c,this._size.y),this._radius=(0,o.n)(t.radius||0,0,l),this["__UnityEngine.BoxCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"BoxCollider2DComponents")}_initializeCode(){this._code=new UnityEngine.BoxCollider2D(this),this["__UnityEngine.BoxCollider2D"]=this._code,super._initializeCode()}getSize(){return this._size.clone()}setSize(t=o.k.ONE){this._size.equals(t)||(this._size.copy(t),this._size.x=Math.max(c,this._size.x),this._size.y=Math.max(c,this._size.y),this.rebuildFixturesIfNecessary())}generateShapes(){const t=[new o.k(-this._size.x/2+this._offset.x,-this._size.y/2+this._offset.y),new o.k(this._size.x/2+this._offset.x,-this._size.y/2+this._offset.y),new o.k(this._size.x/2+this._offset.x,this._size.y/2+this._offset.y),new o.k(-this._size.x/2+this._offset.x,this._size.y/2+this._offset.y)],e=[];for(const i of t)lt.set(i.x,i.y,0),this._relativeTransform.transformPoint(lt,lt),e.push(new at.b2Vec2(lt.x,lt.y));const i=new at.b2PolygonShape,[n,s]=at.pointsToVec2Array(e);return ct.polygonColliderBuilder.ValidatePolygonShape(n,e.length,625e-8)?(i.Set(n,e.length),s(),i.m_radius=this._radius,[i]):(this._errorFlag=!0,at.destroy(i),s(),[])}}ct._polygonColliderBuilder=null,Object.defineProperty(ct,"polygonColliderBuilder",{get:()=>(ct._polygonColliderBuilder||(ct._polygonColliderBuilder=new at.b2PolygonColliderBuilder),ct._polygonColliderBuilder)});class ht extends n.j{constructor(t){super(t),this.id="collider2D",this.performanceSamplerSection=n.d.PHYSICS2D,this._physics2DSystem=n.a.getApplication().systems.physics2D}removeComponent(t,e){e.onDestroy(),super.removeComponent(t,e)}get defaultMaterial(){return this._physics2DSystem.defaultMaterial}set defaultMaterial(t){this._physics2DSystem.defaultMaterial=t}}class dt extends n.j{constructor(t){super(t),this.id="rigidbody2D",this.performanceSamplerSection=n.d.PHYSICS2D,this._physics2DSystem=n.a.getApplication().systems.physics2D}removeComponent(t,e){e.onDestroy(),super.removeComponent(t,e)}get adapter(){return this._physics2DSystem.adapter}}const ut=["onFixedUpdate"];let yt=0,_t=null;pc.waitForBox2D.then((t=>{_t=t}));class pt extends n.k{constructor(t){t=Object.assign({enabled:!0,enableCollision:!1,breakForce:1/0,breakTorque:1/0},t||{}),super(),this.id=yt++,this._enabled=!!t.enabled,this._enableCollision=!!t.enableCollision,this._breakForce=Number.isFinite(t.breakForce)&&t.breakForce>=0?t.breakForce:1/0,this._breakTorque=Number.isFinite(t.breakTorque)&&t.breakTorque>=0?t.breakTorque:1/0,this._attachedRigidbody=null,this._connectedBody=null,this._joint=null,this._type="",this._dt=0,pc.markPhysics2dModuleAsUsed()}get sortingOrderInQueue(){return this._sortingOrderInQueue}get code(){return this._code||this._initializeCode(),this._code}get joint(){return this._joint}get type(){return this._type}get class(){throw new Error("Not implemented")}_initializeCode(){this._code&&(this["__UnityEngine.Joint2D"]=this._code,this._code.handle=this)}onEnable(){return!!super.onEnable()&&(k.instance.enableConstraint(this),!0)}onDisable(){return!!super.onDisable()&&(k.instance.disableConstraint(this),!0)}onDestroy(){return!!super.onDestroy()&&(this.onDisable(),this.destroyJoint(),!0)}enable(){this._enabled=!0,this.createJoint()}disable(){this._enabled=!1,this.destroyJoint()}_queuesToSubscribe(){return ut}onFixedUpdate(t){if(this._enabled){if(this._dt=t,this._breakTorque<1/0){if(this._joint.GetReactionTorque(1/t)>this._breakTorque)return void this.onDestroy()}if(this._breakForce<1/0){this._joint.GetReactionForce(1/t).LengthSquared()>this._breakForce*this._breakForce&&this.onDestroy()}}}recreateJoint(){this.destroyJoint(),this.createJoint()}createJoint(){if(this._joint)return;this._connectedBody=this.code.connectedBody;let t=this._connectedBody&&this._connectedBody.handle;const e=this.getAttachedRigidbody().handle;t||(t=k.instance.groundBody);const i=this._createJoint(e,t);i&&(this._joint=_t.wrapPointer(_t.getPointer(i),this.class),this._joint.SetComponentId(this.id),k.instance.linkJointAndJointComponent(this._joint,this),e.body.SetAwake(!0),t.body.SetAwake(!0))}destroyJoint(){this._joint&&(k.instance.unlinkJointAndJointComponent(this._joint,this),k.instance.world.DestroyJoint(this._joint),this._joint=null)}_createJoint(t,e){throw new Error("Not implemented")}getEnableCollision(){return this._enableCollision}setEnableCollision(t=!1){this._enableCollision!==t&&(this._enableCollision=t,this._joint&&this.recreateJoint())}getAttachedRigidbody(){if(this._attachedRigidbody)return this._attachedRigidbody;const t=this._entity._unityComponents.rigidbody2D[0];return this._attachedRigidbody=UnityEngine.Object.FromHandle(UnityEngine.Rigidbody2D,t),this._attachedRigidbody}getConnectedBody(){return this._connectedBody}setConnectedBody(t){this._connectedBody!==t&&(this._connectedBody=t,this._joint&&this.recreateJoint())}getBreakForce(){return this._breakForce}setBreakForce(t){t<0&&(t=0),this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t<0?0:t}getReactionForce(t){if(t<=0||!this._joint)return new o.k;const e=this._joint.GetReactionForce(1/t);return new o.k(e.x,e.y)}getFrameReactionForce(){if(0===this._dt||!this._joint)return new o.k;const t=this._joint.GetReactionForce(1/this._dt);return new o.k(t.x,t.y)}getReactionTorque(t){return t>0&&this._joint?this._joint.GetReactionTorque(1/t):0}getFrameReactionTorque(){return this._dt>0&&this._joint?this._joint.GetReactionTorque(1/this._dt):0}}let gt=null;pc.waitForBox2D.then((t=>{gt=t}));class mt extends pt{constructor(t){super(t=Object.assign({autoConfigureConnectedAnchor:!0,connectedAnchor:new o.k,anchor:new o.k},t)),this._autoConfigureConnectedAnchor=!!t.autoConfigureConnectedAnchor,this._connectedAnchor=t.connectedAnchor,this._anchor=t.anchor}_initializeCode(){this._code&&(this["__UnityEngine.AnchoredJoint2D"]=this._code),super._initializeCode()}getAutoConfigureConnectedAnchor(){return this._autoConfigureConnectedAnchor}setAutoConfigureConnectedAnchor(t){this._autoConfigureConnectedAnchor!==t&&(this._autoConfigureConnectedAnchor=!!t,this._joint&&this.recreateJoint())}getAnchor(){return this._anchor.clone()}setAnchor(t){this._anchor.equals(t)||(this._anchor.copy(t),this._joint&&this.recreateJoint())}getConnectedAnchor(){return this._connectedAnchor.clone()}setConnectedAnchor(t){this._connectedAnchor.equals(t)||(this._connectedAnchor.copy(t),this._joint&&this.recreateJoint())}configureAnchors(t,e,i,n){const o=i.entity.getLossyScale();t.Set(this._anchor.x*o.x,this._anchor.y*o.y);const s=n.entity.getLossyScale();if(!this._autoConfigureConnectedAnchor)return void e.Set(this._connectedAnchor.x*s.x,this._connectedAnchor.y*s.y);const r=i.body.GetWorldPoint(t);if(!this._connectedBody)return this._connectedAnchor.set(r.x,r.y),void e.Set(this._connectedAnchor.x,this._connectedAnchor.y);const a=n.body.GetLocalPoint(r);this._connectedAnchor.set(a.x/s.x,a.y/s.y),e.Set(a.x,a.y)}configureDistance(t,e,i,n){const o=i.body.GetWorldPoint(t),s=o.x,r=o.y,a=n.body.GetWorldPoint(e),l=s-a.x,c=r-a.y;return Math.sqrt(l*l+c*c)}}let ft=null;pc.waitForBox2D.then((t=>{ft=t}));let Ct=null;pc.waitForBox2D.then((t=>{Ct=t}));let bt=null;pc.waitForBox2D.then((t=>{bt=t}));let xt=null;pc.waitForBox2D.then((t=>{xt=t}));let St=null;pc.waitForBox2D.then((t=>{St=t}));let Dt=null;pc.waitForBox2D.then((t=>{Dt=t}));let wt=null;pc.waitForBox2D.then((t=>{wt=t}));let At=null;pc.waitForBox2D.then((t=>{At=t}));class Mt extends n.j{constructor(t){super(t),this.id="joint2D",this.performanceSamplerSection=n.d.PHYSICS2D}removeComponent(t,e){e.onDestroy(),super.removeComponent(t,e)}}class Tt extends n.j{constructor(t){super(t),this.id="effector2D",this.performanceSamplerSection=n.d.PHYSICS2D}removeComponent(t,e){e.onDestroy(),super.removeComponent(t,e)}}pc.Collider2DComponent=et,pc.CapsuleCollider2DComponent=class extends et{constructor(t){(t=t||{}).type="capsuleCollider2D",super(t),this._offset=(new o.k).copy(t.center||o.k.ZERO),this._size=(new o.k).copy(t.size||new o.k(.5,1)),this._size.x=(0,o.n)(this._size.x,c,l),this._size.y=(0,o.n)(this._size.y,c,l),this._direction=t.direction||UnityEngine.CapsuleDirection2D.Vertical,this["__UnityEngine.CapsuleCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CapsuleCollider2DComponent")}_initializeCode(){this._code=new UnityEngine.CapsuleCollider2D(this),this["__UnityEngine.CapsuleCollider2D"]=this._code,super._initializeCode()}getSize(){return this._size.clone()}setSize(t){this._size.equals(t)||(this._size=t,this.rebuildFixturesIfNecessary())}getDirection(){return this._direction}setDirection(t){this._direction=t,this.rebuildFixturesIfNecessary()}generateShapes(){const t=this._size.clone().scale(.5),e=this._relativeTransform.multiplyPoint(new o.l(-t.x+this._offset.x,this._offset.y,0)),i=this._relativeTransform.multiplyPoint(new o.l(t.x+this._offset.x,this._offset.y,0)),n=this._relativeTransform.multiplyPoint(new o.l(this._offset.x,-t.y+this._offset.y,0)),s=this._relativeTransform.multiplyPoint(new o.l(this._offset.x,t.y+this._offset.y,0)),r=new ot.b2Vec2(e.x,e.y),a=new ot.b2Vec2(i.x,i.y),l=new ot.b2Vec2(n.x,n.y),h=new ot.b2Vec2(s.x,s.y),d=new ot.b2Vec2(a.x-r.x,a.y-r.y),u=new ot.b2Vec2(h.x-l.x,h.y-l.y),y=d.Normalize(),_=u.Normalize(),p=Math.abs(y-_)<=.005?.005:0,g=new ot.b2CapsuleShape;if(this._direction===UnityEngine.CapsuleDirection2D.Vertical){const t=.5*y,e=.5*((_>y?y:_-c)+p),i=new ot.b2Vec2(e*u.x,e*u.y),n=new ot.b2Vec2(l.x+i.x,l.y+i.y),o=new ot.b2Vec2(h.x-i.x,h.y-i.y);g.SetByEndCaps(t,n,o),ot.destroy(i),ot.destroy(n),ot.destroy(o)}else{const t=.5*_,e=.5*((y>_?_:y-c)+p),i=new ot.b2Vec2(e*d.x,e*d.y),n=new ot.b2Vec2(r.x+i.x,r.y+i.y),o=new ot.b2Vec2(a.x-i.x,a.y-i.y);g.SetByEndCaps(t,n,o),ot.destroy(i),ot.destroy(n),ot.destroy(o)}return ot.destroy(r),ot.destroy(a),ot.destroy(l),ot.destroy(h),ot.destroy(d),ot.destroy(u),[g]}},pc.CircleCollider2DComponent=class extends et{constructor(t){(t=t||{}).type="circleCollider2D",super(t),this._offset=(new o.k).copy(t.center||o.k.ZERO),this._radius=(0,o.n)(t.radius||.5,1e-4,1e6),this["__UnityEngine.CircleCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"CircleCollider2DComponent")}_initializeCode(){this._code=new UnityEngine.CircleCollider2D(this),this["__UnityEngine.CircleCollider2D"]=this._code,super._initializeCode()}getRadius(){return this._radius}setRadius(t){this._radius!==t&&(this._radius=t,this.rebuildFixturesIfNecessary())}generateShapes(){rt.set(this._offset.x,this._offset.y,0),this._relativeTransform.transformPoint(rt,rt);const t=this.entity.getLossyScale(),e=(0,o.n)(Math.max(c,Math.max(Math.abs(t.x),Math.abs(t.y))*this._radius),c,l),i=new st.b2CircleShape;return i.m_p.Set(rt.x,rt.y),i.m_radius=e,[i]}},pc.BoxCollider2DComponent=ct,pc.EdgeCollider2DComponent=class extends et{constructor(t){(t=t||{}).type="edgeCollider2D",super(t),this._radius=(0,o.n)(t.radius||0,0,l),this._useAdjacentStartPoint=t.useAdjacentStartPoint||!1,this._useAdjacentEndPoint=t.useAdjacentEndPoint||!1,this._adjacentStartPoint=t.adjacentStartPoint||new o.k,this._adjacentEndPoint=t.adjacentEndPoint||new o.k,this._points=[];const e=t.points||[];for(let t=0,i=0;t<e.length;t+=2,++i)this._points.push(new o.k(e[t],e[t+1]));this["__UnityEngine.EdgeCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"EdgeCollider2DComponent")}get edgeRadius(){return this._radius}set edgeRadius(t){this._radius=t,this.rebuildFixturesIfNecessary()}_initializeCode(){this._code=new UnityEngine.EdgeCollider2D(this),this["__UnityEngine.EdgeCollider2D"]=this._code,super._initializeCode()}getPoints(){return this._points.map((t=>t.clone()))}setPoints(t=[]){this._points=t,this.rebuildFixturesIfNecessary()}getPointCount(){return this._points.length}generateShapes(){const t=[];for(let e=0;e<this._points.length;e++){const i=this._points[e],n=this._relativeTransform.transformPoint(new o.l(i.x+this._offset.x,i.y+this._offset.y,0));t.push(new nt.b2Vec2(n.x,n.y))}for(let e=1;e<t.length;e++){const i=t[e-1],n=t[e],o=i.x-n.x,s=i.y-n.y;o*o+s*s<50249999999999995e-21&&(t.splice(e,1),e--)}if(t.length<2)return this._errorFlag=!0,[];const e=new nt.b2ChainShape;e.m_radius=this._radius+n.i.instance.physics2DSettings.defaultContactOffset;const[i,s]=nt.pointsToVec2Array(t);if(e.CreateChain(i,t.length),s(),this._useAdjacentStartPoint){const t=this._relativeTransform.multiplyPoint(new o.l(this._adjacentStartPoint.x+this._offset.x,this._adjacentStartPoint.y+this._offset.y,0));e.m_prevVertex.Set(t.x,t.y),e.m_hasPrevVertex=!0}if(this._useAdjacentEndPoint){const t=this._relativeTransform.multiplyPoint(new o.l(this._adjacentEndPoint.x+this._offset.x,this._adjacentEndPoint.y+this._offset.y,0));e.m_nextVertex.Set(t.x,t.y),e.m_hasNextVertex=!0}return[e]}},pc.PolygonCollider2DComponent=class extends et{constructor(t){(t=Object.assign({points:[]},t)).type="polygonCollider2D",super(t),this._paths=[];for(let e=0;e<t.points.length;e++){const i=t.points[e],n=[];for(let t=0;t<i.length;t+=2)n.push(new o.k(i[t],i[t+1]));this._paths.push(n)}this["__UnityEngine.PolygonCollider2D"]=null,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"PolygonCollider2DComponent")}_initializeCode(){this._code=new UnityEngine.PolygonCollider2D(this),this["__UnityEngine.PolygonCollider2D"]=this._code,super._initializeCode()}_transformPoints(t){const e=Math.pow(.0025,2),i=[];for(let n=0;n<t.length;n++){const s=this._relativeTransform.multiplyPoint(new o.l(t[n].x+this._offset.x,t[n].y+this._offset.y,0));if(s.lengthSq()>1e12)return null;const r=new o.k(s.x,s.y),a=10*h;Math.abs(r.x)<a&&(r.x=0),Math.abs(r.y)<a&&(r.y=0),i.length>0&&i[i.length-1].clone().sub(r).lengthSq()<=e||i.push(r)}return i}generateShapes(){let t=0;const e=new it.b2PolygonColliderBuilder;for(let i=0;i<this._paths.length;i++){const n=this._transformPoints(this._paths[i]);if(null===n||n.length<3)continue;t++;const o=n.map((t=>new it.b2Vec2(t.x,t.y))),[s,r]=it.pointsToVec2Array(o);e.AddContour(s,o.length),r()}if(0===t)return this._errorFlag=!0,it.destroy(e),[];e.Tesselate();const i=e.GetShapesCount(),n=[];for(let t=0;t<i;t++){const i=e.GetShapeAt(t),o=new it.b2PolygonShape;o.Set(i.m_vertices,i.m_count),n.push(o)}return it.destroy(e),this._errorFlag=this._paths.length!==n.length,n}getPoints(){return 0===this._paths.length?[]:this.getPath(0)}getPath(t){if(t>=this._paths.length||t<0)throw new System.ArgumentOutOfRangeException.ctor;return this._paths[t].map((t=>t.clone()))}setPoints(t){t&&0!==t.length&&this.setPath(0,t)}setPath(t,e){if(!e)throw new System.ArgumentNullException;if(t>0&&t>=this._paths.length||t<0)throw new System.ArgumentOutOfRangeException.ctor;this._paths[t]=e,this.rebuildFixtures()}getPathCount(){return this._paths.length}setPathCount(t){if(this._paths.length!==t){t<0&&(t=0),this._paths.length=t;for(let t=0;t<this._paths.length;t++)this._paths[t]||(this._paths[t]=[]);this.rebuildFixtures()}}getTotalPointCount(){let t=0;for(let e=0;e<this._paths.length;++e)t+=this._paths[e].length;return t}},pc.Collider2DSystem=ht,pc.Rigidbody2DComponent=D,pc.Rigidbody2DSystem=dt,pc.Joint2DComponent=pt,pc.AnchoredJoint2DComponent=mt,pc.DistanceJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({maxDistanceOnly:!1,autoConfigureDistance:!0,distance:1},t)),this._type="distanceJoint2D",this._maxDistanceOnly=!!t.maxDistanceOnly,this._distance=t.distance,this._autoConfigureDistance=!!t.autoConfigureDistance,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"DistanceJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.DistanceJoint2D(this),this["__UnityEngine.DistanceJoint2D"]=this._code,super._initializeCode()}get class(){return this._maxDistanceOnly?wt.b2RopeJoint:wt.b2DistanceJoint}_createJoint(t,e){let i=null;this._maxDistanceOnly?(i=new wt.b2RopeJointDef,this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e),this._autoConfigureDistance&&(this._distance=(0,o.n)(this.configureDistance(i.localAnchorA,i.localAnchorB,t,e),.005,l)),i.maxLength=this._distance):(i=new wt.b2DistanceJointDef,this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e),this._autoConfigureDistance&&(this._distance=(0,o.n)(this.configureDistance(i.localAnchorA,i.localAnchorB,t,e),.005,l)),i.length=this._distance,i.frequencyHz=0,i.dampingRatio=1),i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const n=k.instance.world.CreateJoint(i);return wt.destroy(i),n}getDistance(){return this._distance}setDistance(t){this._distance=t,this._joint&&(this._maxDistanceOnly?this._joint.SetMaxLength(t):this._joint.SetLength(t))}getMaxDistanceOnly(){return this._maxDistanceOnly}setMaxDistanceOnly(t){t=!!t,this._maxDistanceOnly!==t&&this._joint&&this.recreateJoint()}getAutoConfigureDistance(){return this._autoConfigureDistance}setAutoConfigureDistance(t){this._autoConfigureDistance=!!t}},pc.FixedJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({frequency:0,dampingRatio:0},t)),this._type="fixedJoint2D",this._frequency=t.frequency,this._dampingRatio=t.dampingRatio,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"FixedJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.FixedJoint2D(this),this["__UnityEngine.FixedJoint2D"]=this._code,super._initializeCode()}get class(){return Dt.b2WeldJoint}_createJoint(t,e){const i=new Dt.b2WeldJointDef;i.frequencyHz=this._frequency,i.dampingRatio=this._dampingRatio,i.referenceAngle=e.body.GetAngle()-t.body.GetAngle(),i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision,this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e);const n=k.instance.world.CreateJoint(i);return Dt.destroy(i),n}getFrequency(){return this._frequency}setFrequency(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}getReferenceAngle(){return this._joint?this._joint.GetReferenceAngle()*o.j:0}},pc.FrictionJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({maxForce:1,maxTorque:1},t)),this._type="frictionJoint2D",this._maxForce=t.maxForce,this._maxTorque=t.maxTorque,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"FrictionJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.FrictionJoint2D(this),this["__UnityEngine.FrictionJoint2D"]=this._code,super._initializeCode()}get class(){return bt.b2FrictionJoint}_createJoint(t,e){const i=new bt.b2FrictionJointDef;i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e),i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const n=k.instance.world.CreateJoint(i);return bt.destroy(i),n}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce!==t&&(this._maxForce=(0,o.n)(t,0,l),this._joint&&this._joint.SetMaxForce(this._maxForce))}getMaxTorque(){return this._maxTorque}setMaxTorque(t){this._maxTorque!==t&&(this._maxTorque=(0,o.n)(t,0,l),this._joint&&this._joint.SetMaxTorque(this._maxTorque))}},pc.HingeJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({useLimits:!1,useMotor:!1,limits:null,motor:null,useConnectedAnchor:!0},t)),this._type="hingeJoint2D",this._limits=t.limits,this._useLimits=!!t.useLimits,this._motor=t.motor,this._useMotor=!!t.useMotor,this._useConnectedAnchor=!!t.useConnectedAnchor,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"HingeJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.HingeJoint2D(this),this["__UnityEngine.HingeJoint2D"]=this._code,super._initializeCode()}get class(){return St.b2RevoluteJoint}_createJoint(t,e){const i=new St.b2RevoluteJointDef;i.enableMotor=this._useMotor,i.motorSpeed=this._motor?this._motor.motorSpeed*o.e:0,i.maxMotorTorque=this._motor?this._motor.maxMotorTorque:l,i.enableLimit=this._useLimits;const n=(this._limits?this._limits.min:0)*o.e,s=(this._limits?this._limits.max:359)*o.e;i.lowerAngle=Math.min(n,s),i.upperAngle=Math.max(n,s),i.enabledPointConstraint=this._useConnectedAnchor;const r=t.body.GetAngle(),a=e.body.GetAngle();i.referenceAngle=a-r,i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision,this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e);const c=k.instance.world.CreateJoint(i);return St.destroy(i),c}getUseLimits(){return this._useLimits}setUseLimits(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.EnableLimit(t))}getLimits(){if(this._limits)return this._limits.$clone();const t=new UnityEngine.JointAngleLimits2D;return t.max=359,t}setLimits(t){if((!this._limits||this._limits.min!==t.min||this._limits.max!==t.max)&&(this._limits=t,this._joint)){const e=t.min*o.e,i=t.max*o.e;this._joint.SetLimits(Math.min(e,i),Math.max(e,i))}}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.EnableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=l,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.SetMotorSpeed(t.motorSpeed*o.e),e.SetMaxMotorTorque(t.maxMotorTorque))}getJointAngle(){return this._joint?this._joint.GetJointAngle()*o.j:0}},pc.RelativeJoint2DComponent=class extends pt{constructor(t){super(t=Object.assign({autoConfigureOffset:!0,linearOffset:new o.k,angularOffset:0,maxForce:r,maxTorque:r,correctionScale:.3},t)),this._type="relativeJoint2D",this._autoConfigureOffset=!!t.autoConfigureOffset,this._linearOffset=t.linearOffset,this._angularOffset=t.angularOffset,this._maxForce=t.maxForce,this._maxTorque=t.maxTorque,this._correctionScale=t.correctionScale,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"RelativeJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.RelativeJoint2D(this),this["__UnityEngine.RelativeJoint2D"]=this._code,super._initializeCode()}get class(){return Ct.b2MotorJoint}_createJoint(t,e){const i=new Ct.b2MotorJointDef;if(i.maxForce=this._maxForce,i.maxTorque=this._maxTorque,i.correctionFactor=this._correctionScale,this._autoConfigureOffset){const i=t.body.GetLocalPoint(e.body.GetPosition());this._linearOffset.set(i.x,i.y),this._angularOffset=e.body.GetAngle()-t.body.GetAngle()}i.linearOffset.Set(this._linearOffset.x,this._linearOffset.y),i.angularOffset=this._angularOffset*o.e,i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const n=k.instance.world.CreateJoint(i);return Ct.destroy(i),n}getAngularOffset(){return null===this.joint?this._angularOffset:this._joint.GetAngularOffset()*o.j}setAngularOffset(t){this._angularOffset!==t&&(this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t*o.e))}getLinearOffset(){if(null===this.joint)return this._linearOffset;const t=this._joint.GetLinearOffset();return new o.k(t.x,t.y)}setLinearOffset(t){if(!this._linearOffset.equals(t)&&(this._linearOffset.set(t.x,t.y),this._joint)){const t=new Ct.b2Vec2(this._linearOffset.x,this._linearOffset.y);this._joint.SetLinearOffset(t),Ct.destroy(t)}}getAutoConfigureOffset(){return this._autoConfigureOffset}setAutoConfigureOffset(t){this._autoConfigureOffset=!!t}getCorrectionScale(){return this._correctionScale}setCorrectionScale(t){this._correctionScale!==t&&(this._correctionScale=(0,o.n)(t,0,1),this._joint&&this._joint.SetCorrectionFactor(this._correctionScale))}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce!==t&&(this._maxForce=(0,o.n)(t,0,r),this._joint&&this._joint.SetMaxForce(this._maxForce))}getMaxTorque(){return this._maxTorque}setMaxTorque(t){this._maxTorque!==t&&(this._maxTorque=(0,o.n)(t,0,r),this._joint&&this._joint.SetMaxTorque(this._maxTorque))}getTarget(){if(!this._joint)return o.k.ZERO.clone();const t=this._joint,e=this._joint.GetBodyB(),i=e.GetAngle()-t.GetAngularOffset(),n=Math.sin(i),s=Math.cos(i),r=t.GetLinearOffset(),a=s*-r.x-n*-r.y,l=n*-r.x+s*-r.y,c=e.GetPosition();return new o.k(c.x+a,c.y+l)}},pc.SliderJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({autoConfigureAngle:!0,useMotor:!1,useLimits:!1,motor:null,limits:null,angle:0,autoConfigureConnectedAnchor:!1},t)),this._type="sliderJoint2D",this._autoConfigureAngle=!!t.autoConfigureAngle,this._angle=t.angle,this._useMotor=!!t.useMotor,this._motor=t.motor,this._useLimits=!!t.useLimits,this._limits=t.limits,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SliderJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.SliderJoint2D(this),this["__UnityEngine.SliderJoint2D"]=this._code,super._initializeCode()}get class(){return ft.b2PrismaticJoint}_createJoint(t,e){const i=new ft.b2PrismaticJointDef;if(i.enableMotor=this._useMotor,i.enableLimit=this._useLimits,i.motorSpeed=this._motor?this._motor.motorSpeed:0,i.maxMotorForce=this._motor?this._motor.maxMotorTorque:l,i.lowerTranslation=Math.min(this._limits.min,this._limits.max),i.upperTranslation=Math.max(this._limits.min,this._limits.max),i.referenceAngle=e.body.GetAngle()-t.body.GetAngle(),this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e),this._autoConfigureAngle){const n=t.body.GetWorldPoint(i.localAnchorA),s=n.x,r=n.y,a=e.body.GetWorldPoint(i.localAnchorB),c=a.x-s,h=a.y-r;this._angle=(0,o.n)(Math.atan2(h,c)*o.j,-1e6,l)}const n=this._angle*o.e;i.localAxisA.Set(Math.cos(n),Math.sin(n)),i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const s=k.instance.world.CreateJoint(i);return ft.destroy(i),s}getAngle(){return this._angle*o.j}setAngle(t){this._angle!==t&&(this._angle=t,this.recreateJoint())}getReferenceAngle(){return this._joint?this._joint.GetReferenceAngle()*o.j:0}getAutoConfigureAngle(){return this._autoConfigureAngle}setAutoConfigureAngle(t){this._autoConfigureAngle=!!t}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.EnableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=r,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.SetMotorSpeed(t.motorSpeed),e.SetMaxMotorForce(t.maxMotorTorque))}getUseLimits(){return this._useLimits}setUseLimits(t){t=!!t,this._useLimits!==t&&(this._useLimits=t,this._joint&&this._joint.EnableLimit(t))}getLimits(){return this._limits?this._limits.$clone():new UnityEngine.JointTranslationLimits2D}setLimits(t){this.setUseLimits(!0),this._limits&&this._limits.min===t.min&&this._limits.max===t.max||(this._limits=t,this._joint&&this._joint.SetLimits(t.min,t.max))}getLimitState(){if(!this._joint)return UnityEngine.JointLimitState2D.Inactive;switch(this._joint.GetLimitState()){case 0:default:return UnityEngine.JointLimitState2D.Inactive;case 1:return UnityEngine.JointLimitState2D.LowerLimit;case 2:return UnityEngine.JointLimitState2D.UpperLimit;case 3:return UnityEngine.JointLimitState2D.EqualLimits}}getJointTranslation(){return this._joint?this._joint.GetJointTranslation():0}getJointSpeed(){return this._joint?this._joint.GetJointSpeed()*o.j:0}getMotorForce(t){return this._joint&&t>0?this._joint.GetMotorForce(1/t):0}},pc.SpringJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({autoConfigureConnectedAnchor:!1,autoConfigureDistance:!0,distance:1,dampingRatio:0,frequency:1},t)),this._type="springJoint2D",this._frequency=t.frequency,this._dampingRatio=t.dampingRatio,this._distance=t.distance,this._autoConfigureDistance=!!t.autoConfigureDistance,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"SpringJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.SpringJoint2D(this),this["__UnityEngine.SpringJoint2D"]=this._code,super._initializeCode()}get class(){return At.b2DistanceJoint}_createJoint(t,e){const i=new At.b2DistanceJointDef;this.configureAnchors(i.localAnchorA,i.localAnchorB,t,e),this._autoConfigureDistance&&(this._distance=(0,o.n)(this.configureDistance(i.localAnchorA,i.localAnchorB,t,e),.005,l)),i.dampingRatio=this._dampingRatio,i.frequencyHz=this._frequency,i.length=this._distance,i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const n=k.instance.world.CreateJoint(i);return At.destroy(i),n}getDistance(){return this._distance}setDistance(t){this._distance=t,this._joint&&this._joint.SetLength(t)}getFrequency(){return this._frequency}setFrequency(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},pc.TargetJoint2DComponent=class extends pt{constructor(t){super(t=Object.assign({autoConfigureTarget:!0,target:new o.k,anchor:new o.k,maxForce:r,dampingRatio:1,frequency:5},t||{})),this._autoConfigureTarget=!!t.autoConfigureTarget,this._target=t.target,this._anchor=t.anchor,this._maxForce=t.maxForce,this._dampingRatio=t.dampingRatio,this._frequency=t.frequency,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"TargetJoint2DComponent")}get class(){return gt.b2MouseJoint}_initializeCode(){this._code=new UnityEngine.TargetJoint2D(this),this["__UnityEngine.TargetJoint2D"]=this._code,super._initializeCode()}_createJoint(t,e){const i=new gt.b2MouseJointDef;i.bodyA=k.instance.groundBody.body,i.bodyB=t.body,i.collideConnected=!0,i.maxForce=this._maxForce,i.dampingRatio=this._dampingRatio,i.frequencyHz=this._frequency;const n=this.entity.getLossyScale();if(i.localAnchor.Set(this._anchor.x*n.x,this._anchor.y*n.y),this._autoConfigureTarget){const t=this.entity.getPosition();this._target.set(t.x,t.y)}i.target.Set(this._target.x,this._target.y);const o=k.instance.world.CreateJoint(i);return gt.destroy(i),o}setConnectedBody(t){}getAutoConfigureTarget(){return this._autoConfigureTarget}setAutoConfigureTarget(t){this._autoConfigureTarget=!!t}getTarget(){return this._target.clone()}setTarget(t){if(!this._target.equals(t)&&(this._target.copy(t),this._joint)){const t=new gt.b2Vec2(this._target.x,this._target.y);this.joint.SetTarget(t),gt.destroy(t)}}getAnchor(){return this._anchor.clone()}setAnchor(t){this._anchor.equals(t)||(this._anchor=t,this._joint&&this.recreateJoint())}getMaxForce(){return this._maxForce}setMaxForce(t){this._maxForce!==t&&(this._maxForce=(0,o.n)(t,0,l),this._joint&&this.joint.SetMaxForce(this._maxForce))}getFrequency(){return this._frequency}setFrequency(t){this._frequency!==t&&(this._frequency=(0,o.n)(t,0,l),this._joint&&this.joint.SetFrequency(this._frequency))}getDampingRatio(){return this._dampingRatio}setDampingRatio(t){this._dampingRatio!==t&&(this._dampingRatio=(0,o.n)(t,0,1),this._joint&&this.joint.SetDampingRatio(this._dampingRatio))}},pc.WheelJoint2DComponent=class extends mt{constructor(t){super(t=Object.assign({suspension:null,motor:null,useMotor:!1},t)),this._type="wheelJoint2D",this._suspension=t.suspension,this._motor=t.motor,this._useMotor=!!t.useMotor,TESTS&&pc.hiddenShapeValidator.addObjectToValidationSet(this,"WheelJoint2DComponent")}_initializeCode(){this._code=new UnityEngine.WheelJoint2D(this),this["__UnityEngine.WheelJoint2D"]=this._code,super._initializeCode()}get class(){return xt.b2WheelJoint}_createJoint(t,e){if(e===k.instance._groundBody||!e.enabled||!e.entity.enabled)return null;const i=new xt.b2WheelJointDef;i.enableMotor=this._useMotor,i.motorSpeed=this._motor?this._motor.motorSpeed*o.e:0,i.maxMotorTorque=this._motor?this._motor.maxMotorTorque:l,i.frequencyHz=this._suspension?this._suspension.frequency:2,i.dampingRatio=this._suspension?this._suspension.dampingRatio:.7;const n=(this._suspension?this._suspension.angle:90)*o.e;i.localAxisA.Set(Math.cos(n),Math.sin(n));const s=t.entity.getLossyScale(),r=e.entity.getLossyScale();i.localAnchorA.Set(this._anchor.x*s.x,this._anchor.y*s.y),i.localAnchorB.Set(this._connectedAnchor.x*r.x,this._connectedAnchor.y*r.y),i.bodyA=t.body,i.bodyB=e.body,i.collideConnected=this._enableCollision;const a=k.instance.world.CreateJoint(i);return xt.destroy(i),a}getSuspension(){if(this._suspension)return this._suspension.$clone();const t=new UnityEngine.JointSuspension2D;return t.dampingRatio=.7,t.frequency=2,t.angle=90,t}setSuspension(t){this._suspension&&this._suspension.dampingRatio===t.dampingRatio&&this._suspension.frequency===t.frequency&&this._suspension.angle===t.angle||(this._suspension=t,this._joint&&this.recreateJoint())}getUseMotor(){return this._useMotor}setUseMotor(t){t=!!t,this._useMotor!==t&&(this._useMotor=t,this._joint&&this._joint.EnableMotor(t))}getMotor(){if(this._motor)return this._motor.$clone();const t=new UnityEngine.JointMotor2D;return t.maxMotorTorque=l,t}setMotor(t){if(this.setUseMotor(!0),this._motor&&this._motor.motorSpeed===t.motorSpeed&&this._motor.maxMotorTorque===t.maxMotorTorque)return;this._motor=t;const e=this._joint;e&&(e.SetMotorSpeed(t.motorSpeed*o.e),e.SetMaxMotorTorque(t.maxMotorTorque))}getMotorTorque(t){return this._joint&&t>0?this._joint.GetMotorTorque(1/t):0}getJointAngle(){return this._joint?this._joint.GetJointAngle()*o.j:0}getJointSpeed(){return this._joint?this._joint.GetJointAngularSpeed()*o.j:0}getJointTranslation(){return this._joint?this._joint.GetJointTranslation():0}getJointLinearSpeed(){return this._joint?this._joint.GetJointLinearSpeed():0}},pc.Joint2DSystem=Mt,pc.Effector2DComponent=w,pc.PlatformEffector2DComponent=class extends w{_initializeCode(){this._code=new UnityEngine.PlatformEffector2D(this),this["__UnityEngine.PlatformEffector2D"]=this._code,super._initializeCode()}},pc.Effector2DSystem=Tt,pc.Physics2DSystem=P,pc.markPhysics2dModuleAsUsed=()=>{TRACE&&window.traceResults.markModuleAsUsed(window.traceResults.EngineModules.Physics2d)}}},t=>{t.O(0,[1],(()=>{return e=54,t(t.s=e);var e}));t.O()}]);